<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 High performance computing: data.table | R Data Science Book</title>
  <meta name="description" content="8 High performance computing: data.table | R Data Science Book" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="8 High performance computing: data.table | R Data Science Book" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="tillschwoerer/R-data-science-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 High performance computing: data.table | R Data Science Book" />
  
  
  

<meta name="author" content="Tools and Programming Languages for Data Scientists, FH Kiel, Summer Term 2020" />


<meta name="date" content="2020-05-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="stringr.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#goals"><i class="fa fa-check"></i><b>1.1</b> Goals</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#git-and-github"><i class="fa fa-check"></i><b>1.3</b> Git and GitHub</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="readr.html"><a href="readr.html"><i class="fa fa-check"></i><b>2</b> Reading data: readr</a></li>
<li class="chapter" data-level="3" data-path="tidyr.html"><a href="tidyr.html"><i class="fa fa-check"></i><b>3</b> Tidying data: tidyr</a></li>
<li class="chapter" data-level="4" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4</b> Wrangling data: dplyr</a><ul>
<li class="chapter" data-level="4.1" data-path="dplyr.html"><a href="dplyr.html#typical-workflows"><i class="fa fa-check"></i><b>4.1</b> Two typial workflows</a></li>
<li class="chapter" data-level="4.2" data-path="dplyr.html"><a href="dplyr.html#manipulating-rows"><i class="fa fa-check"></i><b>4.2</b> Manipulating rows</a><ul>
<li class="chapter" data-level="4.2.1" data-path="dplyr.html"><a href="dplyr.html#extract-rows"><i class="fa fa-check"></i><b>4.2.1</b> Extract rows</a></li>
<li class="chapter" data-level="4.2.2" data-path="dplyr.html"><a href="dplyr.html#arranging-rows"><i class="fa fa-check"></i><b>4.2.2</b> Arranging rows</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="dplyr.html"><a href="dplyr.html#manipulating-columns"><i class="fa fa-check"></i><b>4.3</b> Manipulating columns</a><ul>
<li class="chapter" data-level="4.3.1" data-path="dplyr.html"><a href="dplyr.html#extract-and-rename-columns"><i class="fa fa-check"></i><b>4.3.1</b> Extract and rename columns</a></li>
<li class="chapter" data-level="4.3.2" data-path="dplyr.html"><a href="dplyr.html#create-new-columns"><i class="fa fa-check"></i><b>4.3.2</b> Create new columns</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dplyr.html"><a href="dplyr.html#scoped-functions"><i class="fa fa-check"></i><b>4.4</b> Scoped functions</a></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html#aggregate"><i class="fa fa-check"></i><b>4.5</b> Aggregate</a></li>
<li class="chapter" data-level="4.6" data-path="dplyr.html"><a href="dplyr.html#window-functions"><i class="fa fa-check"></i><b>4.6</b> Window functions</a></li>
<li class="chapter" data-level="4.7" data-path="dplyr.html"><a href="dplyr.html#combining-tables"><i class="fa fa-check"></i><b>4.7</b> Combining tables</a></li>
<li class="chapter" data-level="4.8" data-path="dplyr.html"><a href="dplyr.html#database-backend"><i class="fa fa-check"></i><b>4.8</b> Database backend</a><ul>
<li class="chapter" data-level="4.8.1" data-path="dplyr.html"><a href="dplyr.html#motivation"><i class="fa fa-check"></i><b>4.8.1</b> Motivation</a></li>
<li class="chapter" data-level="4.8.2" data-path="dplyr.html"><a href="dplyr.html#set-up"><i class="fa fa-check"></i><b>4.8.2</b> Set up</a></li>
<li class="chapter" data-level="4.8.3" data-path="dplyr.html"><a href="dplyr.html#querying-the-database"><i class="fa fa-check"></i><b>4.8.3</b> Querying the database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lubridate.html"><a href="lubridate.html"><i class="fa fa-check"></i><b>5</b> Dates and times: lubridate</a><ul>
<li class="chapter" data-level="5.1" data-path="lubridate.html"><a href="lubridate.html#what-is-lubridate"><i class="fa fa-check"></i><b>5.1</b> What is Lubridate?</a></li>
<li class="chapter" data-level="5.2" data-path="lubridate.html"><a href="lubridate.html#basics"><i class="fa fa-check"></i><b>5.2</b> Basics</a></li>
<li class="chapter" data-level="5.3" data-path="lubridate.html"><a href="lubridate.html#import-data-clean-date-time"><i class="fa fa-check"></i><b>5.3</b> Import data, clean date-time</a></li>
<li class="chapter" data-level="5.4" data-path="lubridate.html"><a href="lubridate.html#check-and-modify-data"><i class="fa fa-check"></i><b>5.4</b> Check and modify data</a></li>
<li class="chapter" data-level="5.5" data-path="lubridate.html"><a href="lubridate.html#before-exploration"><i class="fa fa-check"></i><b>5.5</b> Before exploration</a><ul>
<li class="chapter" data-level="5.5.1" data-path="lubridate.html"><a href="lubridate.html#intervals"><i class="fa fa-check"></i><b>5.5.1</b> Intervals</a></li>
<li class="chapter" data-level="5.5.2" data-path="lubridate.html"><a href="lubridate.html#groupings"><i class="fa fa-check"></i><b>5.5.2</b> Groupings</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="lubridate.html"><a href="lubridate.html#exploration---analysis"><i class="fa fa-check"></i><b>5.6</b> Exploration - Analysis</a><ul>
<li class="chapter" data-level="5.6.1" data-path="lubridate.html"><a href="lubridate.html#temperatur"><i class="fa fa-check"></i><b>5.6.1</b> Temperatur</a></li>
<li class="chapter" data-level="5.6.2" data-path="lubridate.html"><a href="lubridate.html#rainfall"><i class="fa fa-check"></i><b>5.6.2</b> Rainfall</a></li>
<li class="chapter" data-level="5.6.3" data-path="lubridate.html"><a href="lubridate.html#humidity"><i class="fa fa-check"></i><b>5.6.3</b> Humidity</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="lubridate.html"><a href="lubridate.html#wrap-up"><i class="fa fa-check"></i><b>5.7</b> Wrap up</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="forcats.html"><a href="forcats.html"><i class="fa fa-check"></i><b>6</b> Categorical data: forcats</a><ul>
<li class="chapter" data-level="6.1" data-path="forcats.html"><a href="forcats.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="forcats.html"><a href="forcats.html#general-functions"><i class="fa fa-check"></i><b>6.2</b> General functions</a><ul>
<li class="chapter" data-level="6.2.1" data-path="forcats.html"><a href="forcats.html#create"><i class="fa fa-check"></i><b>6.2.1</b> Create</a></li>
<li class="chapter" data-level="6.2.2" data-path="forcats.html"><a href="forcats.html#count-values-per-level"><i class="fa fa-check"></i><b>6.2.2</b> Count values per level</a></li>
<li class="chapter" data-level="6.2.3" data-path="forcats.html"><a href="forcats.html#Inspect-and-set-levels"><i class="fa fa-check"></i><b>6.2.3</b> Inspect and set levels</a></li>
<li class="chapter" data-level="6.2.4" data-path="forcats.html"><a href="forcats.html#inspect-unique-values"><i class="fa fa-check"></i><b>6.2.4</b> Inspect unique values</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="forcats.html"><a href="forcats.html#combine-factors"><i class="fa fa-check"></i><b>6.3</b> Combine factors</a><ul>
<li class="chapter" data-level="6.3.1" data-path="forcats.html"><a href="forcats.html#combine-factors-with-different-levels"><i class="fa fa-check"></i><b>6.3.1</b> Combine factors with different levels</a></li>
<li class="chapter" data-level="6.3.2" data-path="forcats.html"><a href="forcats.html#standardise-levels-of-various-factors"><i class="fa fa-check"></i><b>6.3.2</b> Standardise levels of various factors</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="forcats.html"><a href="forcats.html#order-of-levels"><i class="fa fa-check"></i><b>6.4</b> Order of levels</a><ul>
<li class="chapter" data-level="6.4.1" data-path="forcats.html"><a href="forcats.html#manual-reordering"><i class="fa fa-check"></i><b>6.4.1</b> Manual reordering of levels</a></li>
<li class="chapter" data-level="6.4.2" data-path="forcats.html"><a href="forcats.html#reordering-by-frequency"><i class="fa fa-check"></i><b>6.4.2</b> Reordering by frequency</a></li>
<li class="chapter" data-level="6.4.3" data-path="forcats.html"><a href="forcats.html#reordering-by-appearance"><i class="fa fa-check"></i><b>6.4.3</b> Reordering by appearance</a></li>
<li class="chapter" data-level="6.4.4" data-path="forcats.html"><a href="forcats.html#reverse-level-order"><i class="fa fa-check"></i><b>6.4.4</b> Reverse level order</a></li>
<li class="chapter" data-level="6.4.5" data-path="forcats.html"><a href="forcats.html#shift-levels"><i class="fa fa-check"></i><b>6.4.5</b> Shift levels</a></li>
<li class="chapter" data-level="6.4.6" data-path="forcats.html"><a href="forcats.html#randomly-shuffle-levels"><i class="fa fa-check"></i><b>6.4.6</b> Randomly shuffle levels</a></li>
<li class="chapter" data-level="6.4.7" data-path="forcats.html"><a href="forcats.html#reordering-levels-by-other-variables"><i class="fa fa-check"></i><b>6.4.7</b> Reordering levels by other variables</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="forcats.html"><a href="forcats.html#change-the-value-of-levels"><i class="fa fa-check"></i><b>6.5</b> Change the value of levels</a><ul>
<li class="chapter" data-level="6.5.1" data-path="forcats.html"><a href="forcats.html#renaming-the-levels"><i class="fa fa-check"></i><b>6.5.1</b> Renaming the levels</a></li>
<li class="chapter" data-level="6.5.2" data-path="forcats.html"><a href="forcats.html#anonymize-levels"><i class="fa fa-check"></i><b>6.5.2</b> Anonymize levels</a></li>
<li class="chapter" data-level="6.5.3" data-path="forcats.html"><a href="forcats.html#collapse-multiple-levels-into-one"><i class="fa fa-check"></i><b>6.5.3</b> Collapse multiple levels into one</a></li>
<li class="chapter" data-level="6.5.4" data-path="forcats.html"><a href="forcats.html#aggregate-levels-into-a-lump"><i class="fa fa-check"></i><b>6.5.4</b> Aggregate levels into a lump</a></li>
<li class="chapter" data-level="6.5.5" data-path="forcats.html"><a href="forcats.html#manually-lump-levels"><i class="fa fa-check"></i><b>6.5.5</b> Manually lump levels</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="forcats.html"><a href="forcats.html#add-or-drop-levels"><i class="fa fa-check"></i><b>6.6</b> Add or drop levels</a><ul>
<li class="chapter" data-level="6.6.1" data-path="forcats.html"><a href="forcats.html#add-levels"><i class="fa fa-check"></i><b>6.6.1</b> Add levels</a></li>
<li class="chapter" data-level="6.6.2" data-path="forcats.html"><a href="forcats.html#drop-levels"><i class="fa fa-check"></i><b>6.6.2</b> Drop levels</a></li>
<li class="chapter" data-level="6.6.3" data-path="forcats.html"><a href="forcats.html#assign-a-level-to-nas"><i class="fa fa-check"></i><b>6.6.3</b> Assign a level to <code>NAs</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="stringr.html"><a href="stringr.html"><i class="fa fa-check"></i><b>7</b> Character data: stringr</a><ul>
<li class="chapter" data-level="7.1" data-path="stringr.html"><a href="stringr.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a><ul>
<li class="chapter" data-level="7.1.1" data-path="stringr.html"><a href="stringr.html#use-of-stringr-in-the-r-environment"><i class="fa fa-check"></i><b>7.1.1</b> Use of stringR in the R environment</a></li>
<li class="chapter" data-level="7.1.2" data-path="stringr.html"><a href="stringr.html#types-of-data-which-could-be-used-with-stringr"><i class="fa fa-check"></i><b>7.1.2</b> Types of data, which could be used with stringR</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="stringr.html"><a href="stringr.html#data-set-for-examples"><i class="fa fa-check"></i><b>7.2</b> Data Set for examples</a></li>
<li class="chapter" data-level="7.3" data-path="stringr.html"><a href="stringr.html#regular-expressions"><i class="fa fa-check"></i><b>7.3</b> Regular Expressions</a></li>
<li class="chapter" data-level="7.4" data-path="stringr.html"><a href="stringr.html#functions-of-stringr-explained"><i class="fa fa-check"></i><b>7.4</b> Functions of stringR explained</a><ul>
<li class="chapter" data-level="7.4.1" data-path="stringr.html"><a href="stringr.html#manage-lengths"><i class="fa fa-check"></i><b>7.4.1</b> Manage lengths</a></li>
<li class="chapter" data-level="7.4.2" data-path="stringr.html"><a href="stringr.html#subset-strings"><i class="fa fa-check"></i><b>7.4.2</b> Subset Strings</a></li>
<li class="chapter" data-level="7.4.3" data-path="stringr.html"><a href="stringr.html#detect-matches"><i class="fa fa-check"></i><b>7.4.3</b> Detect matches</a></li>
<li class="chapter" data-level="7.4.4" data-path="stringr.html"><a href="stringr.html#mutate-strings"><i class="fa fa-check"></i><b>7.4.4</b> Mutate Strings</a></li>
<li class="chapter" data-level="7.4.5" data-path="stringr.html"><a href="stringr.html#join-and-split"><i class="fa fa-check"></i><b>7.4.5</b> Join and Split</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="stringr.html"><a href="stringr.html#literature"><i class="fa fa-check"></i><b>7.5</b> Literature</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-table.html"><a href="data-table.html"><i class="fa fa-check"></i><b>8</b> High performance computing: data.table</a><ul>
<li class="chapter" data-level="8.1" data-path="data-table.html"><a href="data-table.html#motivation-1"><i class="fa fa-check"></i><b>8.1</b> Motivation</a></li>
<li class="chapter" data-level="8.2" data-path="data-table.html"><a href="data-table.html#data-exploration"><i class="fa fa-check"></i><b>8.2</b> Data exploration</a><ul>
<li class="chapter" data-level="8.2.1" data-path="data-table.html"><a href="data-table.html#subsetting-rows"><i class="fa fa-check"></i><b>8.2.1</b> Subsetting rows</a></li>
<li class="chapter" data-level="8.2.2" data-path="data-table.html"><a href="data-table.html#selecting-columns"><i class="fa fa-check"></i><b>8.2.2</b> Selecting Columns</a></li>
<li class="chapter" data-level="8.2.3" data-path="data-table.html"><a href="data-table.html#grouping-results"><i class="fa fa-check"></i><b>8.2.3</b> Grouping results</a></li>
<li class="chapter" data-level="8.2.4" data-path="data-table.html"><a href="data-table.html#editing-data"><i class="fa fa-check"></i><b>8.2.4</b> Editing Data</a></li>
<li class="chapter" data-level="8.2.5" data-path="data-table.html"><a href="data-table.html#side-effects"><i class="fa fa-check"></i><b>8.2.5</b> Side effects</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-table.html"><a href="data-table.html#runtime-comparision"><i class="fa fa-check"></i><b>8.3</b> Runtime comparision</a></li>
<li class="chapter" data-level="8.4" data-path="data-table.html"><a href="data-table.html#further-resources"><i class="fa fa-check"></i><b>8.4</b> Further resources</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Data Science Book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data.table" class="section level1">
<h1><span class="header-section-number">8</span> High performance computing: data.table</h1>
<p>Okay, let’s get started with this chapter on high performance computing using the R package data.table.</p>
<pre><code>## [1] &quot;Hello data.table&quot;</code></pre>
<p>If <code>data.table</code> is not yet installed, we install it via:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;data.table&quot;</span> , <span class="dt">repos=</span><span class="st">&quot;http://cran.us.r-project.org&quot;</span>)</a></code></pre></div>
<p>We load <code>data.table</code> package and - to demonstrate the differences - also the <code>tidyverse</code> library.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb404-1" title="1"><span class="kw">library</span>(tidyverse) </a>
<a class="sourceLine" id="cb404-2" title="2"><span class="kw">library</span>(data.table)</a></code></pre></div>
<p>Data.table objects are similar to a data.frame object but with some extensions. Let us first load some data with the <code>data.table</code> file reader fread(), which is optimised for performance and creates a <code>data.table</code> object.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb405-1" title="1">inpOlympic &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">&quot;data/olympic-games.csv&quot;</span>)) {</a>
<a class="sourceLine" id="cb405-2" title="2">   <span class="st">&quot;data/olympic-games.csv&quot;</span></a>
<a class="sourceLine" id="cb405-3" title="3">} </a>
<a class="sourceLine" id="cb405-4" title="4"></a>
<a class="sourceLine" id="cb405-5" title="5"></a>
<a class="sourceLine" id="cb405-6" title="6">inpSpoti &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">&quot;data/spotify_charts_germany.csv&quot;</span>)) {</a>
<a class="sourceLine" id="cb405-7" title="7">   <span class="st">&quot;data/spotify_charts_germany.csv&quot;</span></a>
<a class="sourceLine" id="cb405-8" title="8">} </a>
<a class="sourceLine" id="cb405-9" title="9"></a>
<a class="sourceLine" id="cb405-10" title="10">olympics &lt;-<span class="st"> </span><span class="kw">fread</span>(inpOlympic)</a>
<a class="sourceLine" id="cb405-11" title="11">spotify &lt;-<span class="st"> </span><span class="kw">fread</span>(inpSpoti)</a></code></pre></div>
<div id="motivation-1" class="section level2">
<h2><span class="header-section-number">8.1</span> Motivation</h2>
<p>The package <code>data.table</code> provides an enhanced data frame object called (big surprise: ) <strong>data.table</strong> and a different type of syntax for common types of data manipulations. In this sense it is similar to the tidyverse (especially the dplyr part of it). A <code>data.table</code> object has the following form DT[i,j,by] where i represent the rows, j the columns and by the grouping argument.</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb406-1" title="1"><span class="kw">class</span>(olympics)   <span class="co"># We see that a data.table inherits properties of data.frames</span></a></code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb408-1" title="1">                  <span class="co"># and we can easily cast an data.frame object to data.table</span></a>
<a class="sourceLine" id="cb408-2" title="2"></a>
<a class="sourceLine" id="cb408-3" title="3">matrix &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>),<span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))</a>
<a class="sourceLine" id="cb408-4" title="4"><span class="kw">class</span>(matrix)</a></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb410-1" title="1"><span class="kw">setDT</span>(matrix)</a>
<a class="sourceLine" id="cb410-2" title="2"><span class="kw">class</span>(matrix)</a></code></pre></div>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<p>So what are the main differences between <code>data.table</code> and <code>tidyverse</code>? Why or when would we want to use one or the other</p>
<ul>
<li><strong>Performance:</strong> data.tables are heavily optimised for speed. If performance is crucial, then data.tables might be the better choice.</li>
<li><strong>Syntax:</strong> data.table syntax is concise while tidyverse syntax is more expressive. Code sequences that span multiple lines are easier to read in case of tidyverse syntax due to the pipe (<code>%&gt;%</code>) operator. Overall, the choice is a matter of personal preferences here.</li>
<li><strong>Mutability:</strong> data.tables are mutable, i.e. they can be changed in place (by reference). If this is a desired feature, then we might opt for data.tables.</li>
<li><strong>Quoted and unquoted names:</strong> in data.tables we usually have the option to use either quoted column names (which makes writing functions easier) or unquoted column names (which is convenient for exploration). In dplyr the default is unquoted column names and it is a bit trickier to use quoted column names.</li>
</ul>
<p>Before we go into the details, let’s start with two motivating examples of differences between data.table and tidyverse syntax. First, we want to know the 5 sports with the highest average weight of players in the 2016 summer olympic games.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb412-1" title="1"><span class="co"># data.table syntax is short</span></a>
<a class="sourceLine" id="cb412-2" title="2">olympics[game<span class="op">==</span><span class="st">&quot;2016 Summer&quot;</span>, .(<span class="dt">weight =</span> <span class="kw">mean</span>(weight, <span class="dt">na.rm=</span>T)), sport][<span class="kw">order</span>(<span class="op">-</span>weight)][<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a></code></pre></div>
<pre><code>##         sport   weight
## 1: Basketball 87.86786
## 2: Water Polo 85.44961
## 3:   Handball 83.26912
## 4: Volleyball 80.29329
## 5:     Rowing 79.87226</code></pre>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" title="1"><span class="co"># tidyverse syntax is more expressive and readable</span></a>
<a class="sourceLine" id="cb414-2" title="2">olympics <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb414-3" title="3"><span class="st">  </span><span class="kw">filter</span>(game<span class="op">==</span><span class="st">&quot;2016 Summer&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb414-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(sport) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb414-5" title="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">weight =</span> <span class="kw">mean</span>(weight, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb414-6" title="6"><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>weight) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb414-7" title="7"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<p>Next, we want to change an existing column:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb415-1" title="1"><span class="co"># data.tables are mutable objects, i.e. changes happen in-place</span></a>
<a class="sourceLine" id="cb415-2" title="2">olympics[,age<span class="op">:</span><span class="er">=</span><span class="kw">as.numeric</span>(age)]   <span class="co"># age is coerced from character to numeric</span></a></code></pre></div>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" title="1"><span class="co"># tidyverse&#39;s tibbles are immutable, i.e. we need to reassign to make permanent changes to the data</span></a>
<a class="sourceLine" id="cb416-2" title="2">olympics &lt;-<span class="st"> </span>olympics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">age_numeric =</span><span class="kw">as.numeric</span>(age))</a></code></pre></div>
</div>
<div id="data-exploration" class="section level2">
<h2><span class="header-section-number">8.2</span> Data exploration</h2>
<p>As mentioned before the datatype data.table has the following structure: dt[i,j,by], where i conditon on the rows, j select the colums and by defines the groups by which results are aggregated. We’ll start by setting conditions on the rows.</p>
<div id="subsetting-rows" class="section level3">
<h3><span class="header-section-number">8.2.1</span> Subsetting rows</h3>
<p>We can condition on the rows one time, which gives us all swimmers.</p>
<p>again, for repetition the code tidyverse syntax</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" title="1">swimmers &lt;-<span class="st"> </span>olympics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(sport <span class="op">==</span><span class="st"> &quot;Swimming&quot;</span>)</a></code></pre></div>
<p>and in <code>data.table</code> syntax</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" title="1">swimmers &lt;-<span class="st"> </span>olympics[sport <span class="op">==</span><span class="st"> &quot;Swimming&quot;</span>]</a>
<a class="sourceLine" id="cb418-2" title="2">olympics[sport<span class="op">==</span><span class="st">&quot;Swimming&quot;</span>]                <span class="co"># or without assinging operator</span></a></code></pre></div>
<pre><code>##               game city    sport                                    discipline
##     1: 1952 Summer &lt;NA&gt; Swimming           Swimming Men&#39;s 400 metres Freestyle
##     2: 1912 Summer &lt;NA&gt; Swimming        Swimming Men&#39;s 200 metres Breaststroke
##     3: 1912 Summer &lt;NA&gt; Swimming        Swimming Men&#39;s 400 metres Breaststroke
##     4: 1920 Summer &lt;NA&gt; Swimming        Swimming Men&#39;s 200 metres Breaststroke
##     5: 1920 Summer &lt;NA&gt; Swimming        Swimming Men&#39;s 400 metres Breaststroke
##    ---                                                                        
## 23191: 2000 Summer &lt;NA&gt; Swimming    Swimming Men&#39;s 4 x 100 metres Medley Relay
## 23192: 2004 Summer &lt;NA&gt; Swimming Swimming Men&#39;s 4 x 100 metres Freestyle Relay
## 23193: 1924 Summer &lt;NA&gt; Swimming        Swimming Men&#39;s 200 metres Breaststroke
## 23194: 1980 Summer &lt;NA&gt; Swimming           Swimming Men&#39;s 100 metres Butterfly
## 23195: 1980 Summer &lt;NA&gt; Swimming           Swimming Men&#39;s 200 metres Butterfly
##                                  athlete     country age height weight      bmi
##     1:  Einar Ferdinand &quot;&quot;Einari&quot;&quot; Aalto     Finland  26     NA     NA       NA
##     2:              Arvo Ossian Aaltonen     Finland  22     NA     NA       NA
##     3:              Arvo Ossian Aaltonen     Finland  22     NA     NA       NA
##     4:              Arvo Ossian Aaltonen     Finland  30     NA     NA       NA
##     5:              Arvo Ossian Aaltonen     Finland  30     NA     NA       NA
##    ---                                                                         
## 23191: Klaas Erik &quot;&quot;Klaas-Erik&quot;&quot; Zwering Netherlands  19    189     80 22.39579
## 23192: Klaas Erik &quot;&quot;Klaas-Erik&quot;&quot; Zwering Netherlands  23    189     80 22.39579
## 23193:             Marius Edmund Zwiller      France  18     NA     NA       NA
## 23194:        Bogusaw Stanisaw Zychowicz      Poland  19    189     80 22.39579
## 23195:        Bogusaw Stanisaw Zychowicz      Poland  19    189     80 22.39579
##        sex  medal
##     1:   M   &lt;NA&gt;
##     2:   M   &lt;NA&gt;
##     3:   M   &lt;NA&gt;
##     4:   M Bronze
##     5:   M Bronze
##    ---           
## 23191:   M   &lt;NA&gt;
## 23192:   M Silver
## 23193:   M   &lt;NA&gt;
## 23194:   M   &lt;NA&gt;
## 23195:   M   &lt;NA&gt;</code></pre>
<p>And two or more times with the ‘&amp;’ operator (‘|’ operator for the logical or),for example all gold medal winners in swimming.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" title="1">swimmers_gold &lt;-<span class="st"> </span>olympics[sport <span class="op">==</span><span class="st"> &quot;Swimming&quot;</span> <span class="op">&amp;</span><span class="st"> </span>medal <span class="op">==</span><span class="st"> &quot;Gold&quot;</span>]</a>
<a class="sourceLine" id="cb420-2" title="2"></a>
<a class="sourceLine" id="cb420-3" title="3"></a>
<a class="sourceLine" id="cb420-4" title="4">swimmers_gold_without_doping &lt;-<span class="st"> </span>swimmers_gold[<span class="op">!</span>country<span class="op">==</span><span class="st">&quot;Russia&quot;</span> <span class="op">&amp;</span><span class="st"> </span>country<span class="op">!=</span><span class="st"> &quot;China&quot;</span>]  <span class="co">#the `!` operator negates the logical expression </span></a></code></pre></div>
<p>The <code>i</code> argument also allows for regular expressions</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" title="1">Michael_Phelps &lt;-<span class="st"> </span>olympics[sport<span class="op">==</span><span class="st">&quot;Swimming&quot;</span> <span class="op">&amp;</span><span class="st"> </span>athlete <span class="op">%like%</span><span class="st"> &quot;Phelps&quot;</span>]</a></code></pre></div>
<p>The columns can be treated like variables so the expression <code>olympics$sport</code> is not necessary here but would work too. In additon we can select for the row numbers:</p>
<p>tidyverse:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" title="1">var &lt;-<span class="st"> </span>swimmers <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<p>data.table</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" title="1">var &lt;-<span class="st"> </span>swimmers[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a></code></pre></div>
<p>This is especially useful after ordering the data:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" title="1">height &lt;-<span class="st"> </span>swimmers[<span class="kw">order</span>(height)]</a></code></pre></div>
<p>or in decreasing order( here we pick the first element, so the tallest swimmer)</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" title="1">height &lt;-<span class="st"> </span>swimmers[<span class="kw">order</span>(<span class="op">-</span>height)][<span class="dv">1</span><span class="op">:</span><span class="dv">1</span>]</a></code></pre></div>
<p>The order function, called on data.table objects calls the internal <code>forder()</code> function which is optimised on such objects. Counting rows is possible with different aproaches:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" title="1">usmedals &lt;-<span class="st"> </span>olympics[sport <span class="op">==</span><span class="st"> &quot;Swimming&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(medal), <span class="kw">length</span>(medal)]</a></code></pre></div>
<p>or with the .N approach</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb427-1" title="1">usmedals &lt;-<span class="st"> </span>olympics[sport <span class="op">==</span><span class="st"> &quot;Swimming&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(medal), .N]</a>
<a class="sourceLine" id="cb427-2" title="2">usmedals</a></code></pre></div>
<pre><code>## [1] 3048</code></pre>
<p>As you see above we come now to the second argument of data.table objects:</p>
</div>
<div id="selecting-columns" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Selecting Columns</h3>
<p>Now we want to condition on the colums too. Here we can either write the column names as unquoted names inside a list. Note we can use the <code>.</code> as an abbreviation for <code>list</code> here.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb429-1" title="1">swimmers_gold[, <span class="kw">list</span>(athlete, country, medal)][<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]   <span class="co"># list with unquoted column names </span></a></code></pre></div>
<pre><code>##                        athlete       country medal
## 1: Rebecca &quot;&quot;Becky&quot;&quot; Adlington Great Britain  Gold
## 2: Rebecca &quot;&quot;Becky&quot;&quot; Adlington Great Britain  Gold
## 3:      Nathan Ghar-Jun Adrian United States  Gold
## 4:      Nathan Ghar-Jun Adrian United States  Gold
## 5:      Nathan Ghar-Jun Adrian United States  Gold</code></pre>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" title="1">swimmers_gold[,    .(athlete,country, medal)][<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]   <span class="co"># . is an abbreviation for lists</span></a></code></pre></div>
<pre><code>##                        athlete       country medal
## 1: Rebecca &quot;&quot;Becky&quot;&quot; Adlington Great Britain  Gold
## 2: Rebecca &quot;&quot;Becky&quot;&quot; Adlington Great Britain  Gold
## 3:      Nathan Ghar-Jun Adrian United States  Gold
## 4:      Nathan Ghar-Jun Adrian United States  Gold
## 5:      Nathan Ghar-Jun Adrian United States  Gold</code></pre>
<p>Or we can write the quoted column names inside the <code>c()</code> function.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" title="1">swimmers[,  <span class="kw">c</span>(<span class="st">&quot;athlete&quot;</span>, <span class="st">&quot;medal&quot;</span>)][<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] <span class="co">#</span></a></code></pre></div>
<pre><code>##                             athlete  medal
## 1: Einar Ferdinand &quot;&quot;Einari&quot;&quot; Aalto   &lt;NA&gt;
## 2:             Arvo Ossian Aaltonen   &lt;NA&gt;
## 3:             Arvo Ossian Aaltonen   &lt;NA&gt;
## 4:             Arvo Ossian Aaltonen Bronze
## 5:             Arvo Ossian Aaltonen Bronze</code></pre>
<p>The tidyverse syntax for comparison was</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" title="1">swimmers <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="st">&quot;athlete&quot;</span>, <span class="st">&quot;medal&quot;</span>)</a></code></pre></div>
<p>This syntax also allows us to define the column in a separate step.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" title="1">cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;athlete&quot;</span>, <span class="st">&quot;medal&quot;</span>)  <span class="co"># columns are defined in a separate step</span></a>
<a class="sourceLine" id="cb436-2" title="2">swimmers_gold[, ..cols][<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]        <span class="co"># note the .. syntax  </span></a></code></pre></div>
<pre><code>##                        athlete medal
## 1: Rebecca &quot;&quot;Becky&quot;&quot; Adlington  Gold
## 2: Rebecca &quot;&quot;Becky&quot;&quot; Adlington  Gold
## 3:      Nathan Ghar-Jun Adrian  Gold
## 4:      Nathan Ghar-Jun Adrian  Gold
## 5:      Nathan Ghar-Jun Adrian  Gold</code></pre>
<p>or using the ‘with’ statement</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" title="1">colums &lt;-<span class="st"> </span>swimmers_gold[, cols, with =<span class="st"> </span><span class="ot">FALSE</span>]</a>
<a class="sourceLine" id="cb438-2" title="2"><span class="kw">head</span>(colums)</a></code></pre></div>
<pre><code>##                        athlete medal
## 1: Rebecca &quot;&quot;Becky&quot;&quot; Adlington  Gold
## 2: Rebecca &quot;&quot;Becky&quot;&quot; Adlington  Gold
## 3:      Nathan Ghar-Jun Adrian  Gold
## 4:      Nathan Ghar-Jun Adrian  Gold
## 5:      Nathan Ghar-Jun Adrian  Gold
## 6:      Nathan Ghar-Jun Adrian  Gold</code></pre>
<p>and operations on the rows and colums at the same time:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" title="1">var &lt;-<span class="st"> </span>olympics[sport <span class="op">==</span><span class="st"> &quot;Swimming&quot;</span> <span class="op">&amp;</span><span class="st"> </span>medal <span class="op">==</span><span class="st"> &quot;Gold&quot;</span>, ..cols]</a></code></pre></div>
<p>We can also execute functions on the columns e.g. to find out the average age of all olympians</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb441-1" title="1">olympics[, <span class="kw">mean</span>(age, <span class="dt">na.rm=</span>T)]</a></code></pre></div>
<pre><code>## [1] 25.45227</code></pre>
<p>and last but not least we can directly plot within the <code>j</code> argument (even if the informative value is questionable here)</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" title="1">spotify[,<span class="kw">plot</span>(danceability,Streams)]</a></code></pre></div>
</div>
<div id="grouping-results" class="section level3">
<h3><span class="header-section-number">8.2.3</span> Grouping results</h3>
<p>Now we’ll consider the third parameter of the data.table object DT[i, j, by].
Let’s count the competitions grouped by sports.
(Hint: if we have a look at the data in teamsports, every athlete is listed so caution with this result.)</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" title="1">sports &lt;-<span class="st"> </span>olympics[, .N, by =<span class="st"> &quot;sport&quot;</span>]</a></code></pre></div>
<p>So using all three arguments we find all swimmers, and grouping they by the country</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb445-1" title="1">sw &lt;-<span class="st"> </span>olympics[sport<span class="op">==</span><span class="st"> &quot;Swimming&quot;</span>, .N,by =<span class="st"> </span>country]</a></code></pre></div>
<p>grouping by more colums</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" title="1">sw &lt;-<span class="st"> </span>olympics[sport<span class="op">==</span><span class="st"> &quot;Swimming&quot;</span>, .N,by =<span class="st"> </span>.(country,discipline)]</a></code></pre></div>
<p>If we want to order the data we have to change by to keyby</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb447-1" title="1">sw &lt;-<span class="st"> </span>olympics[sport<span class="op">==</span><span class="st"> &quot;Swimming&quot;</span>, .N,keyby =<span class="st"> </span>.(country,discipline)]</a></code></pre></div>
<p>Chaining operations on the data.table object:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb448-1" title="1">ordOlym &lt;-<span class="st"> </span>olympics[,.N, by =<span class="st"> </span>.(country,game)][<span class="kw">order</span>(<span class="op">-</span>game,country)]</a></code></pre></div>
</div>
<div id="editing-data" class="section level3">
<h3><span class="header-section-number">8.2.4</span> Editing Data</h3>
<p>When we want to edit a Data set of the class dataframe like</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb449-1" title="1">df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;D&quot;</span>,<span class="st">&quot;a&quot;</span>,<span class="st">&quot;t&quot;</span>,<span class="st">&quot;a&quot;</span>), <span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">b =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">c =</span> <span class="dv">9</span><span class="op">:</span><span class="dv">12</span>)</a>
<a class="sourceLine" id="cb449-2" title="2">df</a></code></pre></div>
<pre><code>##   name a b  c
## 1    D 1 5  9
## 2    a 2 6 10
## 3    t 3 7 11
## 4    a 4 8 12</code></pre>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb451-1" title="1">df<span class="op">$</span>c &lt;-<span class="st"> </span><span class="dv">13</span><span class="op">:</span><span class="dv">16</span></a>
<a class="sourceLine" id="cb451-2" title="2">df</a></code></pre></div>
<pre><code>##   name a b  c
## 1    D 1 5 13
## 2    a 2 6 14
## 3    t 3 7 15
## 4    a 4 8 16</code></pre>
<p>this is done via copying the data set and a bad performance. <code>Datatable</code> provides the ‘:=’ operator for an better performance. Here the Data object isn’t copied but edited by reference.</p>
<p>Adding a column</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb453-1" title="1">spotify[, <span class="st">&#39;:=&#39;</span>(<span class="dt">duration_s=</span>duration_ms<span class="op">/</span><span class="dv">1000</span>)]</a></code></pre></div>
<p>this column is added ‘by reference’ which is done with a higher performance than adding a column to a <code>data.frame</code> object. In addition we do not have to assign the expression back to the variable.
Edit an column</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" title="1">olympics[sex<span class="op">==</span><span class="st">&#39;M&#39;</span>, sex <span class="op">:</span><span class="er">=</span><span class="st"> &#39;Male&#39;</span>]</a>
<a class="sourceLine" id="cb454-2" title="2">olympics[sex<span class="op">==</span><span class="st">&#39;F&#39;</span>, sex <span class="op">:</span><span class="er">=</span><span class="st"> &#39;Female&#39;</span>]</a></code></pre></div>
<p>Deleting an column by reference</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb455-1" title="1">spotify[, duration_ms <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a></code></pre></div>
</div>
<div id="side-effects" class="section level3">
<h3><span class="header-section-number">8.2.5</span> Side effects</h3>
<p>Sometimes we’re in the situation that we want to work with a <code>data.table</code> object but not on the object itself but on a copy. For example we want to add again the column duration_ms by reference, then the variable spotify_cols change too.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb456-1" title="1">spotify_cols &lt;-<span class="st"> </span><span class="kw">names</span>(spotify)   <span class="co"># Columnnames</span></a>
<a class="sourceLine" id="cb456-2" title="2">spotify_cols</a></code></pre></div>
<pre><code>##  [1] &quot;Position&quot;         &quot;Track.Name&quot;       &quot;Artist&quot;           &quot;Streams&quot;         
##  [5] &quot;date&quot;             &quot;danceability&quot;     &quot;energy&quot;           &quot;loudness&quot;        
##  [9] &quot;speechiness&quot;      &quot;acousticness&quot;     &quot;instrumentalness&quot; &quot;liveness&quot;        
## [13] &quot;valence&quot;          &quot;tempo&quot;            &quot;duration_s&quot;</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb458-1" title="1">spotify[, <span class="st">&#39;:=&#39;</span>(<span class="dt">duration_ms=</span>duration_s<span class="op">*</span><span class="dv">1000</span>)]</a>
<a class="sourceLine" id="cb458-2" title="2">spotify_cols</a></code></pre></div>
<pre><code>##  [1] &quot;Position&quot;         &quot;Track.Name&quot;       &quot;Artist&quot;           &quot;Streams&quot;         
##  [5] &quot;date&quot;             &quot;danceability&quot;     &quot;energy&quot;           &quot;loudness&quot;        
##  [9] &quot;speechiness&quot;      &quot;acousticness&quot;     &quot;instrumentalness&quot; &quot;liveness&quot;        
## [13] &quot;valence&quot;          &quot;tempo&quot;            &quot;duration_s&quot;       &quot;duration_ms&quot;</code></pre>
<p>If we want to prevent these side effect we have to work on a copy. So again:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" title="1">spotify[, duration_ms <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]   <span class="co"># deleting by reference</span></a>
<a class="sourceLine" id="cb460-2" title="2">spotify_cols</a></code></pre></div>
<pre><code>##  [1] &quot;Position&quot;         &quot;Track.Name&quot;       &quot;Artist&quot;           &quot;Streams&quot;         
##  [5] &quot;date&quot;             &quot;danceability&quot;     &quot;energy&quot;           &quot;loudness&quot;        
##  [9] &quot;speechiness&quot;      &quot;acousticness&quot;     &quot;instrumentalness&quot; &quot;liveness&quot;        
## [13] &quot;valence&quot;          &quot;tempo&quot;            &quot;duration_s&quot;</code></pre>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" title="1">spotify_cols &lt;-<span class="st"> </span><span class="kw">copy</span>(<span class="kw">names</span>(spotify))</a>
<a class="sourceLine" id="cb462-2" title="2">spotify[, <span class="st">&#39;:=&#39;</span>(<span class="dt">duration_ms=</span>duration_s<span class="op">*</span><span class="dv">1000</span>)]</a>
<a class="sourceLine" id="cb462-3" title="3">spotify_cols</a></code></pre></div>
<pre><code>##  [1] &quot;Position&quot;         &quot;Track.Name&quot;       &quot;Artist&quot;           &quot;Streams&quot;         
##  [5] &quot;date&quot;             &quot;danceability&quot;     &quot;energy&quot;           &quot;loudness&quot;        
##  [9] &quot;speechiness&quot;      &quot;acousticness&quot;     &quot;instrumentalness&quot; &quot;liveness&quot;        
## [13] &quot;valence&quot;          &quot;tempo&quot;            &quot;duration_s&quot;</code></pre>
</div>
</div>
<div id="runtime-comparision" class="section level2">
<h2><span class="header-section-number">8.3</span> Runtime comparision</h2>
<p>Let us now compare the runtime of some expression made in <code>data.table</code> and <code>tidyverse</code>. Performance differs depending on the type of operation, and will likely also depend on the size of the data set. Here we test separately sorting, filtering, and grouping/aggregating for our data set of about 270.000 observations.</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;microbenchmark&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb465-1" title="1"><span class="kw">library</span>(microbenchmark)              <span class="co"># package for performance comparisons</span></a>
<a class="sourceLine" id="cb465-2" title="2">olympics_tbl &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(olympics)  <span class="co"># create a tibble to compare performance</span></a>
<a class="sourceLine" id="cb465-3" title="3"></a>
<a class="sourceLine" id="cb465-4" title="4"><span class="co"># Sorting</span></a>
<a class="sourceLine" id="cb465-5" title="5"><span class="kw">microbenchmark</span>(</a>
<a class="sourceLine" id="cb465-6" title="6">  olympics_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(age),     <span class="co"># dplyr</span></a>
<a class="sourceLine" id="cb465-7" title="7">  olympics[<span class="kw">order</span>(age)],              <span class="co"># data.table</span></a>
<a class="sourceLine" id="cb465-8" title="8">  <span class="dt">times =</span> <span class="dv">5</span>                          <span class="co"># run 5 time to get more robust measurements</span></a>
<a class="sourceLine" id="cb465-9" title="9">) </a></code></pre></div>
<pre><code>## Unit: milliseconds
##                           expr     min       lq      mean   median       uq
##  olympics_tbl %&gt;% arrange(age) 96.3809 104.7948 133.48596 107.9655 126.5487
##           olympics[order(age)] 35.7042  43.1039  63.02072  43.2537  53.3242
##       max neval
##  231.7399     5
##  139.7176     5</code></pre>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb467-1" title="1"><span class="co"># Filtering</span></a>
<a class="sourceLine" id="cb467-2" title="2"><span class="kw">microbenchmark</span>(</a>
<a class="sourceLine" id="cb467-3" title="3">  olympics_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(height <span class="op">&gt;</span><span class="st"> </span><span class="dv">160</span>),   <span class="co"># dplyr</span></a>
<a class="sourceLine" id="cb467-4" title="4">  olympics[height <span class="op">&gt;</span><span class="st"> </span><span class="dv">160</span>],                  <span class="co"># data.table</span></a>
<a class="sourceLine" id="cb467-5" title="5">  <span class="dt">times =</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb467-6" title="6">)</a></code></pre></div>
<pre><code>## Unit: milliseconds
##                                   expr     min      lq     mean  median      uq
##  olympics_tbl %&gt;% filter(height &gt; 160) 14.8139 16.1564 19.60014 16.8633 18.0434
##                 olympics[height &gt; 160] 11.5326 12.5000 16.11734 13.8222 16.7287
##      max neval
##  32.1237     5
##  26.0032     5</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb469-1" title="1"><span class="co"># Grouping</span></a>
<a class="sourceLine" id="cb469-2" title="2"><span class="kw">microbenchmark</span>(</a>
<a class="sourceLine" id="cb469-3" title="3">  olympics_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(athlete) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="kw">mean</span>(height, <span class="dt">na.rm=</span>T)),  <span class="co"># dplyr</span></a>
<a class="sourceLine" id="cb469-4" title="4">  olympics[, .(<span class="kw">mean</span>(height, <span class="dt">na.rm=</span>T)), <span class="dt">keyby=</span>athlete],                      <span class="co"># data.table</span></a>
<a class="sourceLine" id="cb469-5" title="5">  <span class="dt">times =</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb469-6" title="6">) </a></code></pre></div>
<pre><code>## Unit: milliseconds
##                                                                            expr
##  olympics_tbl %&gt;% group_by(athlete) %&gt;% summarise(mean(height,      na.rm = T))
##                         olympics[, .(mean(height, na.rm = T)), keyby = athlete]
##        min        lq      mean    median        uq       max neval
##  2526.8202 2547.5901 2573.3637 2570.1466 2587.2232 2635.0385     5
##   543.5562  549.2586  580.5558  565.2651  580.7441  663.9551     5</code></pre>
</div>
<div id="further-resources" class="section level2">
<h2><span class="header-section-number">8.4</span> Further resources</h2>
<p>Here are links to further resources on the package <code>data.table</code>:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-intro.html">Vignette Intro</a></li>
<li><a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-reference-semantics.html">Vignette on reference semantics</a></li>
<li><a href="https://github.com/Rdatatable/data.table/wiki">Github Wiki</a></li>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/master/datatable.pdf">Cheatsheet</a></li>
<li><a href="https://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly">data.table vs. dplyr</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="stringr.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/tillschwoerer/R-data-science-book/blob/master/datatable.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
