<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Dates and times: lubridate | R Data Science Book</title>
  <meta name="description" content="5 Dates and times: lubridate | R Data Science Book" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Dates and times: lubridate | R Data Science Book" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="tillschwoerer/R-data-science-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Dates and times: lubridate | R Data Science Book" />
  
  
  

<meta name="author" content="Tools and Programming Languages for Data Scientists, FH Kiel, Summer Term 2020" />


<meta name="date" content="2020-05-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dplyr.html"/>
<link rel="next" href="forcats.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#goals"><i class="fa fa-check"></i><b>1.1</b> Goals</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#git-and-github"><i class="fa fa-check"></i><b>1.3</b> Git and GitHub</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="readr.html"><a href="readr.html"><i class="fa fa-check"></i><b>2</b> Reading data: readr</a></li>
<li class="chapter" data-level="3" data-path="tidyr.html"><a href="tidyr.html"><i class="fa fa-check"></i><b>3</b> Tidying data: tidyr</a></li>
<li class="chapter" data-level="4" data-path="dplyr.html"><a href="dplyr.html"><i class="fa fa-check"></i><b>4</b> Wrangling data: dplyr</a><ul>
<li class="chapter" data-level="4.1" data-path="dplyr.html"><a href="dplyr.html#typical-workflows"><i class="fa fa-check"></i><b>4.1</b> Two typial workflows</a></li>
<li class="chapter" data-level="4.2" data-path="dplyr.html"><a href="dplyr.html#manipulating-rows"><i class="fa fa-check"></i><b>4.2</b> Manipulating rows</a><ul>
<li class="chapter" data-level="4.2.1" data-path="dplyr.html"><a href="dplyr.html#extract-rows"><i class="fa fa-check"></i><b>4.2.1</b> Extract rows</a></li>
<li class="chapter" data-level="4.2.2" data-path="dplyr.html"><a href="dplyr.html#arranging-rows"><i class="fa fa-check"></i><b>4.2.2</b> Arranging rows</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="dplyr.html"><a href="dplyr.html#manipulating-columns"><i class="fa fa-check"></i><b>4.3</b> Manipulating columns</a><ul>
<li class="chapter" data-level="4.3.1" data-path="dplyr.html"><a href="dplyr.html#extract-and-rename-columns"><i class="fa fa-check"></i><b>4.3.1</b> Extract and rename columns</a></li>
<li class="chapter" data-level="4.3.2" data-path="dplyr.html"><a href="dplyr.html#create-new-columns"><i class="fa fa-check"></i><b>4.3.2</b> Create new columns</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dplyr.html"><a href="dplyr.html#scoped-functions"><i class="fa fa-check"></i><b>4.4</b> Scoped functions</a></li>
<li class="chapter" data-level="4.5" data-path="dplyr.html"><a href="dplyr.html#aggregate"><i class="fa fa-check"></i><b>4.5</b> Aggregate</a></li>
<li class="chapter" data-level="4.6" data-path="dplyr.html"><a href="dplyr.html#window-functions"><i class="fa fa-check"></i><b>4.6</b> Window functions</a></li>
<li class="chapter" data-level="4.7" data-path="dplyr.html"><a href="dplyr.html#combining-tables"><i class="fa fa-check"></i><b>4.7</b> Combining tables</a></li>
<li class="chapter" data-level="4.8" data-path="dplyr.html"><a href="dplyr.html#database-backend"><i class="fa fa-check"></i><b>4.8</b> Database backend</a><ul>
<li class="chapter" data-level="4.8.1" data-path="dplyr.html"><a href="dplyr.html#motivation"><i class="fa fa-check"></i><b>4.8.1</b> Motivation</a></li>
<li class="chapter" data-level="4.8.2" data-path="dplyr.html"><a href="dplyr.html#set-up"><i class="fa fa-check"></i><b>4.8.2</b> Set up</a></li>
<li class="chapter" data-level="4.8.3" data-path="dplyr.html"><a href="dplyr.html#querying-the-database"><i class="fa fa-check"></i><b>4.8.3</b> Querying the database</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lubridate.html"><a href="lubridate.html"><i class="fa fa-check"></i><b>5</b> Dates and times: lubridate</a><ul>
<li class="chapter" data-level="5.1" data-path="lubridate.html"><a href="lubridate.html#what-is-lubridate"><i class="fa fa-check"></i><b>5.1</b> What is Lubridate?</a></li>
<li class="chapter" data-level="5.2" data-path="lubridate.html"><a href="lubridate.html#basics"><i class="fa fa-check"></i><b>5.2</b> Basics</a></li>
<li class="chapter" data-level="5.3" data-path="lubridate.html"><a href="lubridate.html#import-data-clean-date-time"><i class="fa fa-check"></i><b>5.3</b> Import data, clean date-time</a></li>
<li class="chapter" data-level="5.4" data-path="lubridate.html"><a href="lubridate.html#check-and-modify-data"><i class="fa fa-check"></i><b>5.4</b> Check and modify data</a></li>
<li class="chapter" data-level="5.5" data-path="lubridate.html"><a href="lubridate.html#before-exploration"><i class="fa fa-check"></i><b>5.5</b> Before exploration</a><ul>
<li class="chapter" data-level="5.5.1" data-path="lubridate.html"><a href="lubridate.html#intervals"><i class="fa fa-check"></i><b>5.5.1</b> Intervals</a></li>
<li class="chapter" data-level="5.5.2" data-path="lubridate.html"><a href="lubridate.html#groupings"><i class="fa fa-check"></i><b>5.5.2</b> Groupings</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="lubridate.html"><a href="lubridate.html#exploration---analysis"><i class="fa fa-check"></i><b>5.6</b> Exploration - Analysis</a><ul>
<li class="chapter" data-level="5.6.1" data-path="lubridate.html"><a href="lubridate.html#temperatur"><i class="fa fa-check"></i><b>5.6.1</b> Temperatur</a></li>
<li class="chapter" data-level="5.6.2" data-path="lubridate.html"><a href="lubridate.html#precipitation"><i class="fa fa-check"></i><b>5.6.2</b> Precipitation</a></li>
<li class="chapter" data-level="5.6.3" data-path="lubridate.html"><a href="lubridate.html#humidity"><i class="fa fa-check"></i><b>5.6.3</b> Humidity</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="lubridate.html"><a href="lubridate.html#wrap-up"><i class="fa fa-check"></i><b>5.7</b> Wrap up</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="forcats.html"><a href="forcats.html"><i class="fa fa-check"></i><b>6</b> Categorical data: forcats</a><ul>
<li class="chapter" data-level="6.1" data-path="forcats.html"><a href="forcats.html#introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="forcats.html"><a href="forcats.html#general-functions"><i class="fa fa-check"></i><b>6.2</b> General functions</a><ul>
<li class="chapter" data-level="6.2.1" data-path="forcats.html"><a href="forcats.html#create"><i class="fa fa-check"></i><b>6.2.1</b> Create</a></li>
<li class="chapter" data-level="6.2.2" data-path="forcats.html"><a href="forcats.html#count-values-per-level"><i class="fa fa-check"></i><b>6.2.2</b> Count values per level</a></li>
<li class="chapter" data-level="6.2.3" data-path="forcats.html"><a href="forcats.html#Inspect-and-set-levels"><i class="fa fa-check"></i><b>6.2.3</b> Inspect and set levels</a></li>
<li class="chapter" data-level="6.2.4" data-path="forcats.html"><a href="forcats.html#inspect-unique-values"><i class="fa fa-check"></i><b>6.2.4</b> Inspect unique values</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="forcats.html"><a href="forcats.html#combine-factors"><i class="fa fa-check"></i><b>6.3</b> Combine factors</a><ul>
<li class="chapter" data-level="6.3.1" data-path="forcats.html"><a href="forcats.html#combine-factors-with-different-levels"><i class="fa fa-check"></i><b>6.3.1</b> Combine factors with different levels</a></li>
<li class="chapter" data-level="6.3.2" data-path="forcats.html"><a href="forcats.html#standardise-levels-of-various-factors"><i class="fa fa-check"></i><b>6.3.2</b> Standardise levels of various factors</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="forcats.html"><a href="forcats.html#order-of-levels"><i class="fa fa-check"></i><b>6.4</b> Order of levels</a><ul>
<li class="chapter" data-level="6.4.1" data-path="forcats.html"><a href="forcats.html#manual-reordering"><i class="fa fa-check"></i><b>6.4.1</b> Manual reordering of levels</a></li>
<li class="chapter" data-level="6.4.2" data-path="forcats.html"><a href="forcats.html#reordering-by-frequency"><i class="fa fa-check"></i><b>6.4.2</b> Reordering by frequency</a></li>
<li class="chapter" data-level="6.4.3" data-path="forcats.html"><a href="forcats.html#reordering-by-appearance"><i class="fa fa-check"></i><b>6.4.3</b> Reordering by appearance</a></li>
<li class="chapter" data-level="6.4.4" data-path="forcats.html"><a href="forcats.html#reverse-level-order"><i class="fa fa-check"></i><b>6.4.4</b> Reverse level order</a></li>
<li class="chapter" data-level="6.4.5" data-path="forcats.html"><a href="forcats.html#shift-levels"><i class="fa fa-check"></i><b>6.4.5</b> Shift levels</a></li>
<li class="chapter" data-level="6.4.6" data-path="forcats.html"><a href="forcats.html#randomly-shuffle-levels"><i class="fa fa-check"></i><b>6.4.6</b> Randomly shuffle levels</a></li>
<li class="chapter" data-level="6.4.7" data-path="forcats.html"><a href="forcats.html#reordering-levels-by-other-variables"><i class="fa fa-check"></i><b>6.4.7</b> Reordering levels by other variables</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="forcats.html"><a href="forcats.html#change-the-value-of-levels"><i class="fa fa-check"></i><b>6.5</b> Change the value of levels</a><ul>
<li class="chapter" data-level="6.5.1" data-path="forcats.html"><a href="forcats.html#renaming-the-levels"><i class="fa fa-check"></i><b>6.5.1</b> Renaming the levels</a></li>
<li class="chapter" data-level="6.5.2" data-path="forcats.html"><a href="forcats.html#anonymize-levels"><i class="fa fa-check"></i><b>6.5.2</b> Anonymize levels</a></li>
<li class="chapter" data-level="6.5.3" data-path="forcats.html"><a href="forcats.html#collapse-multiple-levels-into-one"><i class="fa fa-check"></i><b>6.5.3</b> Collapse multiple levels into one</a></li>
<li class="chapter" data-level="6.5.4" data-path="forcats.html"><a href="forcats.html#aggregate-levels-into-a-lump"><i class="fa fa-check"></i><b>6.5.4</b> Aggregate levels into a lump</a></li>
<li class="chapter" data-level="6.5.5" data-path="forcats.html"><a href="forcats.html#manually-lump-levels"><i class="fa fa-check"></i><b>6.5.5</b> Manually lump levels</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="forcats.html"><a href="forcats.html#add-or-drop-levels"><i class="fa fa-check"></i><b>6.6</b> Add or drop levels</a><ul>
<li class="chapter" data-level="6.6.1" data-path="forcats.html"><a href="forcats.html#add-levels"><i class="fa fa-check"></i><b>6.6.1</b> Add levels</a></li>
<li class="chapter" data-level="6.6.2" data-path="forcats.html"><a href="forcats.html#drop-levels"><i class="fa fa-check"></i><b>6.6.2</b> Drop levels</a></li>
<li class="chapter" data-level="6.6.3" data-path="forcats.html"><a href="forcats.html#assign-a-level-to-nas"><i class="fa fa-check"></i><b>6.6.3</b> Assign a level to <code>NAs</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="stringr.html"><a href="stringr.html"><i class="fa fa-check"></i><b>7</b> Character data: stringr</a><ul>
<li class="chapter" data-level="7.1" data-path="stringr.html"><a href="stringr.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a><ul>
<li class="chapter" data-level="7.1.1" data-path="stringr.html"><a href="stringr.html#use-of-stringr-in-the-r-environment"><i class="fa fa-check"></i><b>7.1.1</b> Use of stringR in the R environment</a></li>
<li class="chapter" data-level="7.1.2" data-path="stringr.html"><a href="stringr.html#types-of-data-which-could-be-used-with-stringr"><i class="fa fa-check"></i><b>7.1.2</b> Types of data, which could be used with stringR</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="stringr.html"><a href="stringr.html#data-set-for-examples"><i class="fa fa-check"></i><b>7.2</b> Data Set for examples</a></li>
<li class="chapter" data-level="7.3" data-path="stringr.html"><a href="stringr.html#regular-expressions"><i class="fa fa-check"></i><b>7.3</b> Regular Expressions</a></li>
<li class="chapter" data-level="7.4" data-path="stringr.html"><a href="stringr.html#functions-of-stringr-explained"><i class="fa fa-check"></i><b>7.4</b> Functions of stringR explained</a><ul>
<li class="chapter" data-level="7.4.1" data-path="stringr.html"><a href="stringr.html#manage-lengths"><i class="fa fa-check"></i><b>7.4.1</b> Manage lengths</a></li>
<li class="chapter" data-level="7.4.2" data-path="stringr.html"><a href="stringr.html#subset-strings"><i class="fa fa-check"></i><b>7.4.2</b> Subset Strings</a></li>
<li class="chapter" data-level="7.4.3" data-path="stringr.html"><a href="stringr.html#detect-matches"><i class="fa fa-check"></i><b>7.4.3</b> Detect matches</a></li>
<li class="chapter" data-level="7.4.4" data-path="stringr.html"><a href="stringr.html#mutate-strings"><i class="fa fa-check"></i><b>7.4.4</b> Mutate Strings</a></li>
<li class="chapter" data-level="7.4.5" data-path="stringr.html"><a href="stringr.html#join-and-split"><i class="fa fa-check"></i><b>7.4.5</b> Join and Split</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="stringr.html"><a href="stringr.html#literature"><i class="fa fa-check"></i><b>7.5</b> Literature</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-table.html"><a href="data-table.html"><i class="fa fa-check"></i><b>8</b> High performance computing: data.table</a><ul>
<li class="chapter" data-level="8.1" data-path="data-table.html"><a href="data-table.html#motivation-1"><i class="fa fa-check"></i><b>8.1</b> Motivation</a></li>
<li class="chapter" data-level="8.2" data-path="data-table.html"><a href="data-table.html#data-exploration"><i class="fa fa-check"></i><b>8.2</b> Data exploration</a><ul>
<li class="chapter" data-level="8.2.1" data-path="data-table.html"><a href="data-table.html#subsetting-rows"><i class="fa fa-check"></i><b>8.2.1</b> Subsetting rows</a></li>
<li class="chapter" data-level="8.2.2" data-path="data-table.html"><a href="data-table.html#selecting-columns"><i class="fa fa-check"></i><b>8.2.2</b> Selecting Columns</a></li>
<li class="chapter" data-level="8.2.3" data-path="data-table.html"><a href="data-table.html#grouping-results"><i class="fa fa-check"></i><b>8.2.3</b> Grouping results</a></li>
<li class="chapter" data-level="8.2.4" data-path="data-table.html"><a href="data-table.html#editing-data"><i class="fa fa-check"></i><b>8.2.4</b> Editing Data</a></li>
<li class="chapter" data-level="8.2.5" data-path="data-table.html"><a href="data-table.html#side-effects"><i class="fa fa-check"></i><b>8.2.5</b> Side effects</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="data-table.html"><a href="data-table.html#runtime-comparision"><i class="fa fa-check"></i><b>8.3</b> Runtime comparision</a></li>
<li class="chapter" data-level="8.4" data-path="data-table.html"><a href="data-table.html#further-resources"><i class="fa fa-check"></i><b>8.4</b> Further resources</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Data Science Book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lubridate" class="section level1">
<h1><span class="header-section-number">5</span> Dates and times: lubridate</h1>
<p>Resources:</p>
<ul>
<li><a href="https://lubridate.tidyverse.org/">Lubridate homepage</a></li>
<li><a href="https://rawgit.com/rstudio/cheatsheets/master/lubridate.pdf">Cheatsheet</a></li>
<li><a href="https://r4ds.had.co.nz/dates-and-times.html">Book Chapter in R4DS</a></li>
<li><a href="https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html">Vignette</a></li>
</ul>
<p>Suggested data set: weather-kiel-holtenau</p>
<div id="what-is-lubridate" class="section level2">
<h2><span class="header-section-number">5.1</span> What is Lubridate?</h2>
<p>Lubridate is an R-Package designed to ease working with date/time variables. These can be challenging in baseR and lubridate allows for frictionless, lubricious working with dates and times, hence the name.</p>
<p>Lubridate is part of the tidyverse package, but can be installed separately as well. It probably reveals most of its usefullness in collaboration with other tidyverse packages. A useful extension, depending on your data, might be the time-series package which is not part of tidyverse.</p>
<p>All mentioned packages can be optained with the following commands in the RStudio consol:</p>
<ul>
<li><code>install.packages("lubridate")</code></li>
<li><code>install.packages("tidyverse")</code></li>
<li><code>install.packages("testit")</code></li>
</ul>
<p>If they have already been installed previously in your environment, they might have to be called using <code>library(tidyverse)</code> and so forth - see code chunks below.</p>
</div>
<div id="basics" class="section level2">
<h2><span class="header-section-number">5.2</span> Basics</h2>
<p>Some examples of real world date-time formats found in datasets:</p>
<p>How people talk about dates and times often differs from the notation. Depending on the specific use of the data, the given information might be more or less granular.
When people in the USA talk distance between two places, they often give an approximation of how long it will take for a person to drive from A to B and round up or down to the hour.</p>
<p>Flight schedules will most likely be exact to the minute, while some sensor data will probably need to be exact to the second. So there will be differing granularity in date and time data.</p>
<p>Even if this would not be challenging, we still would have to deal with different notations of date and time. People in Germany will write a day-date like: <em>dd.mm.yyyy</em> or short dd.mm.yy, while the anglo-saxon realm will use <em>mm.dd.yyyy</em> frequently and the most chronologically sound way would be to use <em>yyyy.mm.dd</em>, but this doesn’t seem to stick with humans.</p>
<p>On top of these issues there’s the fact that time itself does not make the impression of being the most exact parameter out there. Physical time might appear linear, but the way our planet revolves within our galaxy has made it neccessary to adjust date and times every now and then, so our calendar stays in tune with defined periods and seasons. This creates leap years, skipped seconds, daylight-savings time and last, but not least time-zones, which can mess things up even further. After defining date-time data as distinct <em>“places in time”</em> often the need for calculation with them arises.</p>
</div>
<div id="import-data-clean-date-time" class="section level2">
<h2><span class="header-section-number">5.3</span> Import data, clean date-time</h2>
<p>We will apply the lubridate package to weather data from on stationary sensor in northern Germany, the weather station in Kiel-Holtenau to be more exact.</p>
<p>Before we introduce the library, the technical prerequisites must be created.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1"><span class="kw">library</span>(readr)          <span class="co"># part of the tidyverse</span></a>
<a class="sourceLine" id="cb60-2" title="2"><span class="kw">library</span>(lubridate)      <span class="co"># the mentioned lubrication for date-time wrangling</span></a>
<a class="sourceLine" id="cb60-3" title="3"><span class="kw">library</span>(tidyverse)      <span class="co"># the tidyverse with its dplyr functions for data wrangling</span></a>
<a class="sourceLine" id="cb60-4" title="4"><span class="kw">library</span>(ggplot2)        <span class="co"># data visualisation package (is actually part of tidyverse, but still)</span></a>
<a class="sourceLine" id="cb60-5" title="5"><span class="kw">library</span>(testit)         <span class="co"># testing data selections</span></a></code></pre></div>
<p>With the lubridate package activated, we can now call some simple functions to check where we are in time:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1"><span class="co"># Lubridate</span></a>
<a class="sourceLine" id="cb61-2" title="2"><span class="kw">today</span>()                 <span class="co"># date like YYYY-mm-dd</span></a></code></pre></div>
<pre><code>## [1] &quot;2020-05-14&quot;</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1"><span class="co"># Lubridate</span></a>
<a class="sourceLine" id="cb63-2" title="2"><span class="kw">now</span>()                   <span class="co"># timestamp like YYYY-mm-dd HH:MM:SS TZ</span></a></code></pre></div>
<pre><code>## [1] &quot;2020-05-14 09:15:59 CEST&quot;</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1"><span class="co"># Base R</span></a>
<a class="sourceLine" id="cb65-2" title="2"><span class="kw">Sys.Date</span>()              <span class="co"># date like YYYY-mm-dd</span></a></code></pre></div>
<pre><code>## [1] &quot;2020-05-14&quot;</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1"><span class="co"># Base R</span></a>
<a class="sourceLine" id="cb67-2" title="2"><span class="kw">Sys.time</span>()              <span class="co"># timestamp like YYYY-mm-dd HH:MM:SS TZ</span></a></code></pre></div>
<pre><code>## [1] &quot;2020-05-14 09:15:59 CEST&quot;</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1"><span class="co"># Base R</span></a>
<a class="sourceLine" id="cb69-2" title="2"><span class="kw">Sys.timezone</span>()          <span class="co"># actual timezone &quot;Europe/Berlin&quot;</span></a></code></pre></div>
<pre><code>## [1] &quot;Europe/Berlin&quot;</code></pre>
<p>The function <code>today()</code> delivers a date, while <code>now()</code> delivers a date-time (a date + a time).
The third is a baseR function that produces the date, the operating system sees as current, while the fourth displays the systems full current timestamp.
The first two functions are lubridate functions, which behave just nicer and allow for fluent calculations, while the subseqeunt functions are baseR and therefore case sensitive.</p>
<p>Now let’s have a look at some real world data and the challenges of date-time formatting.</p>
<p>A first step is to import the data, which is given in a csv-format.
We will use the tidyverse version of <code>read_csv()</code> to accomplish this step.</p>
<p>The data will be called <code>df</code> (data.frame) in order to allow for briefer referencing in the code further down.</p>
<p>This is the simple approach to read a file with suffix csv.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1">df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/weather_kiel_holtenau.csv&quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   STATIONS_ID = col_double(),
##   MESS_DATUM = col_double(),
##   TEMPERATUR = col_double(),
##   RELATIVE_FEUCHTE = col_double(),
##   NIEDERSCHLAGSDAUER = col_double(),
##   NIEDERSCHLAGSHOEHE = col_double(),
##   NIEDERSCHLAGSINDIKATOR = col_double()
## )</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1"><span class="kw">head</span>(df, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   STATIONS_ID MESS_DATUM TEMPERATUR RELATIVE_FEUCHTE NIEDERSCHLAGSDA~
##         &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1        2564    2.02e11        3.6             75.6                0
## 2        2564    2.02e11        3.6             75.6                6
## 3        2564    2.02e11        3.6             76.5                0
## 4        2564    2.02e11        3.5             75.6                0
## 5        2564    2.02e11        3.6             75.3                0
## # ... with 2 more variables: NIEDERSCHLAGSHOEHE &lt;dbl&gt;,
## #   NIEDERSCHLAGSINDIKATOR &lt;dbl&gt;</code></pre>
<p>All columns are recognized as double values.</p>
<p>By looking at the <code>MESS_DATUM</code> column it becomes apparent that this represents a timestamp that was created every 10 minutes. The standard column type definition of the import tool was not able to format this appropriately, which is why the column will be defined as a double for now.</p>
<p>Using the code generator of the data import tool it is possible to format the variables in the appropriate classes. The code snippet is automatically generated by the import tool of RStudio. For our concern of the timestamp variable please note the part <code>MESS_DATUM = col_datetime(format = "%Y%m%d%H%M"), ...</code> which will reach our present goal to format the timestamp and class as a POSIXct.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1">df &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/weather_kiel_holtenau.csv&quot;</span>,</a>
<a class="sourceLine" id="cb75-2" title="2">               <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">MESS_DATUM =</span> <span class="kw">col_datetime</span>(<span class="dt">format =</span> <span class="st">&quot;%Y%m%d%H%M&quot;</span>),</a>
<a class="sourceLine" id="cb75-3" title="3">                                <span class="dt">NIEDERSCHLAGSDAUER =</span> <span class="kw">col_integer</span>(),</a>
<a class="sourceLine" id="cb75-4" title="4">                                <span class="dt">NIEDERSCHLAGSINDIKATOR =</span> <span class="kw">col_integer</span>(),</a>
<a class="sourceLine" id="cb75-5" title="5">                                <span class="dt">STATIONS_ID =</span> <span class="kw">col_integer</span>()))</a>
<a class="sourceLine" id="cb75-6" title="6"></a>
<a class="sourceLine" id="cb75-7" title="7"><span class="kw">head</span>(df, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   STATIONS_ID MESS_DATUM          TEMPERATUR RELATIVE_FEUCHTE NIEDERSCHLAGSDA~
##         &lt;int&gt; &lt;dttm&gt;                   &lt;dbl&gt;            &lt;dbl&gt;            &lt;int&gt;
## 1        2564 2019-04-14 00:00:00        3.6             75.6                0
## 2        2564 2019-04-14 00:10:00        3.6             75.6                6
## 3        2564 2019-04-14 00:20:00        3.6             76.5                0
## 4        2564 2019-04-14 00:30:00        3.5             75.6                0
## 5        2564 2019-04-14 00:40:00        3.6             75.3                0
## # ... with 2 more variables: NIEDERSCHLAGSHOEHE &lt;dbl&gt;,
## #   NIEDERSCHLAGSINDIKATOR &lt;int&gt;</code></pre>
<p>We will examine the data further down below. At this point it should be mentioned again that we generated the code to import the data by using the import readr tool of RStudio.
This allows a first look at the raw csv data before importing and some tweaking of the variables and their classes. We left the locale portion of the import tool untouched.</p>
<p>The following lines of code import the same data in the <code>MESS_DATUM</code> column as a string of characters again and then call a specific lubridate function (<code>ymd()</code><a href="#lubridate-footnote"><sup>1</sup></a><a name="lubridate-foot-target"></a>) which basically recognizes the time format in the column given only very little information.
In our case we only specify the order in which the date-time information is given, which is Year-Month-Day-Hour-Minute. The <code>ymd_hm()</code> function delivers the desired result.
This function however only works if it is applied to a character string, which is why we chose to overwrite the dataset <code>df</code> with a new import procedure in which we explicitly assign the column <code>MESS_DATUM</code> to be of type character after import to than be able to transform it into a date-time.</p>
<p><a name="lubridate-footnote"></a>TEST<sub><a href="#lubridate-foot-target">1</a>. <code>ymd</code> stands for year-month-day</sub></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1">df1 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/weather_kiel_holtenau.csv&quot;</span>,</a>
<a class="sourceLine" id="cb77-2" title="2">                <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">MESS_DATUM =</span> <span class="kw">col_character</span>(),</a>
<a class="sourceLine" id="cb77-3" title="3">                                 <span class="dt">NIEDERSCHLAGSINDIKATOR =</span> <span class="kw">col_integer</span>(),</a>
<a class="sourceLine" id="cb77-4" title="4">                                 <span class="dt">STATIONS_ID =</span> <span class="kw">col_integer</span>()))</a>
<a class="sourceLine" id="cb77-5" title="5"></a>
<a class="sourceLine" id="cb77-6" title="6">df1<span class="op">$</span>MESS_DATUM &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(df1<span class="op">$</span>MESS_DATUM)</a>
<a class="sourceLine" id="cb77-7" title="7"><span class="kw">head</span>(df1, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   STATIONS_ID MESS_DATUM          TEMPERATUR RELATIVE_FEUCHTE NIEDERSCHLAGSDA~
##         &lt;int&gt; &lt;dttm&gt;                   &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1        2564 2019-04-14 00:00:00        3.6             75.6                0
## 2        2564 2019-04-14 00:10:00        3.6             75.6                6
## 3        2564 2019-04-14 00:20:00        3.6             76.5                0
## 4        2564 2019-04-14 00:30:00        3.5             75.6                0
## 5        2564 2019-04-14 00:40:00        3.6             75.3                0
## # ... with 2 more variables: NIEDERSCHLAGSHOEHE &lt;dbl&gt;,
## #   NIEDERSCHLAGSINDIKATOR &lt;int&gt;</code></pre>
<p>As can be seen above, the <code>MESS_DATUM</code> is now in a POSIXct format again, which is what will be needed for further calculations and analysis of the data set.</p>
<p>Alternatively you could use the following parsing function to achieve the same result. Note that the timestamp needs to be of type character for the <code>parse_date_time()</code> function of lubridate, too.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1">df2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/weather_kiel_holtenau.csv&quot;</span>,</a>
<a class="sourceLine" id="cb79-2" title="2">                <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">MESS_DATUM =</span> <span class="kw">col_character</span>()))</a>
<a class="sourceLine" id="cb79-3" title="3"></a>
<a class="sourceLine" id="cb79-4" title="4">df2<span class="op">$</span>MESS_DATUM &lt;-<span class="st"> </span><span class="kw">parse_date_time</span>(df2<span class="op">$</span>MESS_DATUM, <span class="dt">orders =</span><span class="st">&quot;Ymd HM&quot;</span>)</a>
<a class="sourceLine" id="cb79-5" title="5"><span class="kw">head</span>(df2, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   STATIONS_ID MESS_DATUM          TEMPERATUR RELATIVE_FEUCHTE NIEDERSCHLAGSDA~
##         &lt;dbl&gt; &lt;dttm&gt;                   &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1        2564 2019-04-14 00:00:00        3.6             75.6                0
## 2        2564 2019-04-14 00:10:00        3.6             75.6                6
## 3        2564 2019-04-14 00:20:00        3.6             76.5                0
## 4        2564 2019-04-14 00:30:00        3.5             75.6                0
## 5        2564 2019-04-14 00:40:00        3.6             75.3                0
## # ... with 2 more variables: NIEDERSCHLAGSHOEHE &lt;dbl&gt;,
## #   NIEDERSCHLAGSINDIKATOR &lt;dbl&gt;</code></pre>
<p>OK, we have successfully formated the time-stamp data into a productive date-time (dttm) format using three different aproaches.</p>
</div>
<div id="check-and-modify-data" class="section level2">
<h2><span class="header-section-number">5.4</span> Check and modify data</h2>
<p>The next steps are a check and elimination procedure to eliminate missing values (NAs) from the dataset,
if some observations might have failed to generate a timestamp.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1">df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(MESS_DATUM)) <span class="op">%&gt;%</span><span class="st">                   </span><span class="co"># Checking if there are observations with a missing MESS_DATUM</span></a>
<a class="sourceLine" id="cb81-3" title="3"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## # A tibble: 0 x 7
## # ... with 7 variables: STATIONS_ID &lt;int&gt;, MESS_DATUM &lt;dttm&gt;, TEMPERATUR &lt;dbl&gt;,
## #   RELATIVE_FEUCHTE &lt;dbl&gt;, NIEDERSCHLAGSDAUER &lt;int&gt;, NIEDERSCHLAGSHOEHE &lt;dbl&gt;,
## #   NIEDERSCHLAGSINDIKATOR &lt;int&gt;</code></pre>
<p>We don’t encounter any NAs in the <code>MESS_DATUM</code> column. Eliminating NAs from the <code>MESS_DATUM</code> column including the other variables of that specific observations from the data frame would have been possible with:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb83-2" title="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(MESS_DATUM))                      <span class="co"># missing MESS_DATUM observations (NAs) would/will be excluded from the data frame</span></a></code></pre></div>
<p>Now it is time to have a first explorative look at the data set.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1"><span class="kw">max</span>(df<span class="op">$</span>MESS_DATUM)                                <span class="co"># The latest observation is dated 10 minutes before midnight on the 13th of April 2020</span></a></code></pre></div>
<pre><code>## [1] &quot;2020-04-13 23:50:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1"><span class="kw">min</span>(df<span class="op">$</span>MESS_DATUM)                                <span class="co"># The earliest observation is dated 14th of April 2019</span></a></code></pre></div>
<pre><code>## [1] &quot;2019-04-14 UTC&quot;</code></pre>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1"><span class="kw">range</span>(df<span class="op">$</span>MESS_DATUM)                              <span class="co"># Another way to get the same information</span></a></code></pre></div>
<pre><code>## [1] &quot;2019-04-14 00:00:00 UTC&quot; &quot;2020-04-13 23:50:00 UTC&quot;</code></pre>
<p>We are dealing with data over the course of one year starting on midnight 14th April 2019 until 10 minutes to midnight on 13th April 2020.</p>
<p>To gather some information on the other variables we can use the <code>range()</code> function again.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" title="1"><span class="kw">range</span>(df<span class="op">$</span>STATIONS_ID)                             <span class="co"># This confirms: We are only dealing with data from one and only one weather sensor in the whole data set.</span></a></code></pre></div>
<pre><code>## [1] 2564 2564</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" title="1"><span class="kw">range</span>(df<span class="op">$</span>TEMPERATUR)                              <span class="co"># We have a range of temperatures between -2.5 and +32.1 degrees  celius, which sounds about plausible.</span></a></code></pre></div>
<pre><code>## [1] -2.5 32.1</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" title="1"><span class="kw">range</span>(df<span class="op">$</span>RELATIVE_FEUCHTE)                        <span class="co"># Delivers an unexpected range, where the minimum is -999 and the maximum is +100. Both values are either not possible (-999) or only of theoretic value (+100)</span></a></code></pre></div>
<pre><code>## [1] -999  100</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1"><span class="kw">range</span>(df<span class="op">$</span>NIEDERSCHLAGSDAUER)                      <span class="co"># This delivers an implausible minimum of -999 and an expected maximum of 10 (the maximum amount of minutes in a 10 minute interval).</span></a></code></pre></div>
<pre><code>## [1] -999   10</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1"><span class="kw">range</span>(df<span class="op">$</span>NIEDERSCHLAGSHOEHE)                      <span class="co"># Again the range shows a minimum at -999 and a maximum of 7.85 which has to be interpreted as mm which equals litres per square meter (6 x 7.85 = 47.1/h = torrential)</span></a></code></pre></div>
<pre><code>## [1] -999.00    7.85</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1"><span class="kw">range</span>(df<span class="op">$</span>NIEDERSCHLAGSINDIKATOR)                  <span class="co"># A look at the data reveals a binary 1 or a 0 for this variable, i.e. it rained or it didn&#39;t. -999 must be interpreted as a failed observation</span></a></code></pre></div>
<pre><code>## [1] -999    1</code></pre>
<p>Here we find a so called <em>fill value</em> of <code>-999</code> or <code>-999.00</code> for some observations in a number of variables. These observations are spurious and would have to be deleted from the table to obtain operable data.
Theoretically, the following columns are only relevant if the <code>NIEDERSCHLAGSINDIKATOR</code> is set to 1, indicating precipitation.
This column can be considered like a switch for the other two precipitation-related columns:
* <code>NIEDERSCHLAGSDAUER</code>
* <code>NIEDERSCHLAGSHOEHE</code></p>
<p>Getting an idea about the extent of weird/failed observations can be accomplished with the following code snippet:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1">values_of_ind &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb102-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(NIEDERSCHLAGSINDIKATOR) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb102-3" title="3"><span class="st">  </span><span class="kw">tally</span>()    <span class="co"># count the occurences of the distinct values of NIEDERSCHLAGSINDIKATOR</span></a>
<a class="sourceLine" id="cb102-4" title="4">        </a>
<a class="sourceLine" id="cb102-5" title="5"><span class="kw">head</span>(values_of_ind)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   NIEDERSCHLAGSINDIKATOR     n
##                    &lt;int&gt; &lt;int&gt;
## 1                   -999   127
## 2                      0 43290
## 3                      1  9287</code></pre>
<p>So 127 observations of precipitation are faulty. To modify the <code>NIEDERSCHLAGSINDIKATOR</code> for upcoming analysis we do the following in order to set the -999 Values to a more neutral Zero:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1">df<span class="op">$</span>NIEDERSCHLAGSINDIKATOR &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df<span class="op">$</span>NIEDERSCHLAGSINDIKATOR <span class="op">==</span><span class="st"> </span><span class="dv">-999</span>, <span class="dv">0</span>, df<span class="op">$</span>NIEDERSCHLAGSINDIKATOR)</a>
<a class="sourceLine" id="cb104-2" title="2"></a>
<a class="sourceLine" id="cb104-3" title="3">value_of_ind_n &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb104-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(NIEDERSCHLAGSINDIKATOR) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb104-5" title="5"><span class="st">  </span><span class="kw">tally</span>()</a>
<a class="sourceLine" id="cb104-6" title="6"></a>
<a class="sourceLine" id="cb104-7" title="7"><span class="kw">head</span>(value_of_ind_n)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   NIEDERSCHLAGSINDIKATOR     n
##                    &lt;dbl&gt; &lt;int&gt;
## 1                      0 43417
## 2                      1  9287</code></pre>
<p>We now have a binary indicator of precipitation. Over the course of the observed year precipiation was observed for <span class="math inline">\(9287/43417 = 21.4\%\)</span> of the time frames.</p>
<p>The column <code>RELATIVE_FEUCHTE</code> must also be adjusted in the same way.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1">values_of_rel &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb106-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(RELATIVE_FEUCHTE) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-3" title="3"><span class="st">  </span><span class="kw">filter</span>(RELATIVE_FEUCHTE <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-4" title="4"><span class="st">  </span><span class="kw">tally</span>()</a>
<a class="sourceLine" id="cb106-5" title="5"></a>
<a class="sourceLine" id="cb106-6" title="6"><span class="kw">head</span>(values_of_rel)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   RELATIVE_FEUCHTE     n
##              &lt;dbl&gt; &lt;int&gt;
## 1             -999   128</code></pre>
<p>The negative values are set to 0 again.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1">df<span class="op">$</span>RELATIVE_FEUCHTE &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df<span class="op">$</span>RELATIVE_FEUCHTE <span class="op">==</span><span class="st"> </span><span class="dv">-999</span>, <span class="dv">0</span>, df<span class="op">$</span>RELATIVE_FEUCHTE)</a>
<a class="sourceLine" id="cb108-2" title="2"></a>
<a class="sourceLine" id="cb108-3" title="3">values_of_rel_n &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb108-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(RELATIVE_FEUCHTE) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb108-5" title="5"><span class="st">  </span><span class="kw">tally</span>()</a>
<a class="sourceLine" id="cb108-6" title="6"></a>
<a class="sourceLine" id="cb108-7" title="7"><span class="kw">head</span>(values_of_rel_n)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   RELATIVE_FEUCHTE     n
##              &lt;dbl&gt; &lt;int&gt;
## 1              0     128
## 2             25       1
## 3             25.4     1
## 4             25.5     1
## 5             25.8     1
## 6             26.3     1</code></pre>
<p>The column <code>NIEDERSCHLAGSHOEHE</code> can also be tested and adjusted similarly.
This is not strictly necessary since the negative values could be hidden from further analysis using the <code>NIEDERSCHLAGSINDIKATOR</code>.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1">values_of_ARN &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb110-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(NIEDERSCHLAGSHOEHE) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-3" title="3"><span class="st">  </span><span class="kw">filter</span>(NIEDERSCHLAGSHOEHE <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-4" title="4"><span class="st">  </span><span class="kw">tally</span>()</a>
<a class="sourceLine" id="cb110-5" title="5"></a>
<a class="sourceLine" id="cb110-6" title="6"><span class="kw">head</span>(values_of_ARN)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   NIEDERSCHLAGSHOEHE     n
##                &lt;dbl&gt; &lt;int&gt;
## 1               -999   129</code></pre>
<p>The negative values are set to 0 again.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1">df<span class="op">$</span>NIEDERSCHLAGSHOEHE &lt;-<span class="st"> </span><span class="kw">ifelse</span>(df<span class="op">$</span>NIEDERSCHLAGSHOEHE <span class="op">==</span><span class="st"> </span><span class="dv">-999</span>, <span class="dv">0</span>, df<span class="op">$</span>NIEDERSCHLAGSHOEHE)</a>
<a class="sourceLine" id="cb112-2" title="2"></a>
<a class="sourceLine" id="cb112-3" title="3">values_of_RFH &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb112-4" title="4"><span class="st">  </span><span class="kw">group_by</span>(NIEDERSCHLAGSHOEHE) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb112-5" title="5"><span class="st">  </span><span class="kw">tally</span>()</a>
<a class="sourceLine" id="cb112-6" title="6"></a>
<a class="sourceLine" id="cb112-7" title="7"><span class="kw">head</span>(values_of_RFH)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   NIEDERSCHLAGSHOEHE     n
##                &lt;dbl&gt; &lt;int&gt;
## 1               0    47753
## 2               0.01   712
## 3               0.02   343
## 4               0.03   377
## 5               0.04   397
## 6               0.05   234</code></pre>
<p>We have set the variable <code>NIEDERSCHLAGSHOEHE</code> to 0 in case of these 129 oberservations. The bias that is introduced by this modification can be called negligible in the light of a total 47,753 observations.</p>
</div>
<div id="before-exploration" class="section level2">
<h2><span class="header-section-number">5.5</span> Before exploration</h2>
<p>We now have clean and tidy data and can begin with general exploration, analysis and interpretation.</p>
<p>The <code>TEMPERATUR</code> is given in degrees Celsius, the <code>RELATIVE_FEUCHTE</code> is a percentage Value for humidity which refers to the amount of water vapor present in the air relative to the maximum amount of water vapor the air could hold before at a given temperature.
As the temperature increases, the air can hold larger amounts of water vapor, hence the relativity of this variable. This relation is referred to as the <a href="https://en.wikipedia.org/wiki/Clausius%E2%80%93Clapeyron_relation#Meteorology_and_climatology">Clausius-Clapyron relation</a></p>
<p>The next variable is <code>NIEDERSCHLAGSDAUER</code> which is given as an integer smaller or equal to 10. Therefore it gives the time it has rained during the timestamp interval of 10 Minutes.</p>
<p>The variable <code>NIEDERSCHLAGSHOEHE</code> is a measure of precipitytion intensity. Its maximum value can also be checked by the following command:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1"><span class="kw">max</span>(df<span class="op">$</span>NIEDERSCHLAGSHOEHE, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] 7.85</code></pre>
<p>We can assume that this number gives us the amount of precipitation in milimeters, which is a common definiton and is equivalent as liters of rainfall per squaremeter in a given time interval. A strong event in central Europe can be expected to generate around <span class="math inline">\(30\ \frac{mm}{h}\)</span> of precipitation, i.e. <span class="math inline">\(30\ \frac{l}{m^2 h}\)</span>r. The maximum value is therefore an indicator of a very heavy downpour as a continuation for a whole hour would have yielded <span class="math inline">\(6 \times 7.85\ \frac{l}{m^2} = 47.1\ \frac{l}{m^2}\)</span>.</p>
<p>The next variable is simply a binary expression of precipitation (1) or no precipitation (0) in the given interval. This is a relevant measure as some types of precipitation do not seem to generate enough water to messure an actual amount of water. The dreaded Northgerman “drizzle” comes to mind.</p>
<p>Again: Since the sensor has taken a snapshot every 10 minutes, we have six observations per hour.</p>
<div id="intervals" class="section level3">
<h3><span class="header-section-number">5.5.1</span> Intervals</h3>
<p>Lubridate allows for the definition of an interval object with the <code>interval</code> class. An interval is simply defined as the time elapsed between two points on the date-time line.</p>
<p>e.g. the interval of a single day - from the first of March to the second of March can be defined as follows:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1">tag_int &lt;-<span class="st"> </span><span class="kw">interval</span>(<span class="kw">ymd</span>(<span class="st">&quot;2020-03-01&quot;</span>), <span class="kw">ymd</span>(<span class="st">&quot;2020-03-02&quot;</span>))</a>
<a class="sourceLine" id="cb116-2" title="2"><span class="kw">class</span>(tag_int)</a></code></pre></div>
<pre><code>## [1] &quot;Interval&quot;
## attr(,&quot;package&quot;)
## [1] &quot;lubridate&quot;</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" title="1"><span class="kw">range</span>(<span class="kw">int_start</span>(tag_int), <span class="kw">int_end</span>(tag_int))</a></code></pre></div>
<pre><code>## [1] &quot;2020-03-01 UTC&quot; &quot;2020-03-02 UTC&quot;</code></pre>
<p>This small interval of one day turned out to be good for further analysis.
It facilitates to check results at a glance without having to query the whole dataset.
Note that <code>int_start()</code> and <code>int_end()</code> are used to obtain the start date and end date of the interval, respectively.</p>
<p>When the desired results can be achieved for a small interval we could consider the interval next in size, e.g. Week, month, quarter and year.</p>
<div id="durations-and-periods" class="section level4">
<h4><span class="header-section-number">5.5.1.1</span> Durations and periods</h4>
<p>For any weather data, an analysis of seasonal differences is a natural (excuse the pun) objective.
The beginning of each year’s seasons align with the solar incidences, i.e. the spring and autumnal equinoxes and the days of most and least sunlight hours in summer and winter, respectively.</p>
<p>The following code snippets define the starting points of the different seasons as points on the POSIXct timeline and use these points to calculate new points by later adding durations and periods to them.</p>
<p>For a seasons view, we create the appropriate points in time, where each season begins.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1">season_<span class="dv">19</span>_spring &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(<span class="st">&quot;2019-03-20 22:58&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;CET&quot;</span>)</a>
<a class="sourceLine" id="cb120-2" title="2">season_<span class="dv">19</span>_summer &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(<span class="st">&quot;2019-06-21 17:54&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;CET&quot;</span>)</a>
<a class="sourceLine" id="cb120-3" title="3">season_<span class="dv">19</span>_autumn &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(<span class="st">&quot;2019-09-23 09:50&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;CET&quot;</span>)</a>
<a class="sourceLine" id="cb120-4" title="4">season_<span class="dv">19</span>_winter &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(<span class="st">&quot;2019-12-22 05:19&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;CET&quot;</span>)</a>
<a class="sourceLine" id="cb120-5" title="5">season_<span class="dv">20</span>_spring &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(<span class="st">&quot;2020-03-20 04:49&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;CET&quot;</span>)</a>
<a class="sourceLine" id="cb120-6" title="6">season_<span class="dv">20</span>_summer &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(<span class="st">&quot;2020-06-20 23:43&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;CET&quot;</span>)</a></code></pre></div>
<p>Source: Beginnings of seasons from <a href="https://www.timeanddate.de/astronomie/jahreszeiten">timeanddate.de</a></p>
<p>Our goal shall be to create an interval for the spring season.
The following information is available to determine the end point of spring:</p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">Spring 2020</th>
<th align="left">Summer 2020</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Start</strong></td>
<td align="left">March 20, 04:49</td>
<td align="left">June 20, 23:43</td>
</tr>
<tr class="even">
<td><strong>Duration</strong></td>
<td align="left">92 days, 17 hours, 54 min.</td>
<td align="left">93 days, 15 hours, 46 min.</td>
</tr>
</tbody>
</table>
<div id="durations" class="section level5">
<h5><span class="header-section-number">5.5.1.1.1</span> Durations</h5>
<p>First approach utilizing the <code>Duration</code> class of lubridate:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;spring 2020 - start: &quot;</span>, season_<span class="dv">20</span>_spring))</a></code></pre></div>
<pre><code>## [1] &quot;spring 2020 - start:  2020-03-20 04:49:00&quot;</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1"><span class="kw">class</span>(<span class="kw">ddays</span>(<span class="dv">92</span>)) <span class="co"># The lubridate function ddays() creates a `Duration` object</span></a></code></pre></div>
<pre><code>## [1] &quot;Duration&quot;
## attr(,&quot;package&quot;)
## [1] &quot;lubridate&quot;</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1">season_<span class="dv">20</span>_spring_end &lt;-<span class="st"> </span>season_<span class="dv">20</span>_spring <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb125-2" title="2"><span class="st">                          </span><span class="kw">ddays</span>(<span class="dv">92</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb125-3" title="3"><span class="st">                          </span><span class="kw">dhours</span>(<span class="dv">17</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb125-4" title="4"><span class="st">                          </span><span class="kw">dminutes</span>(<span class="dv">54</span>)</a>
<a class="sourceLine" id="cb125-5" title="5"></a>
<a class="sourceLine" id="cb125-6" title="6"><span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">&quot;Resulting end of spring: &quot;</span>, season_<span class="dv">20</span>_spring_end,</a>
<a class="sourceLine" id="cb125-7" title="7">            <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Expected end of spring:  &quot;</span>, season_<span class="dv">20</span>_summer))</a></code></pre></div>
<pre><code>## Resulting end of spring:  2020-06-20 23:43:00 
## Expected end of spring:   2020-06-20 23:43:00</code></pre>
</div>
<div id="periods" class="section level5">
<h5><span class="header-section-number">5.5.1.1.2</span> Periods</h5>
<p>Second approach utilizing the <code>Period</code> class of lubridate:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" title="1"><span class="kw">class</span>(<span class="kw">days</span>(<span class="dv">92</span>)) <span class="co"># The lubridate function days() creates a `Period` object</span></a></code></pre></div>
<pre><code>## [1] &quot;Period&quot;
## attr(,&quot;package&quot;)
## [1] &quot;lubridate&quot;</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1">season_<span class="dv">20</span>_spring_per &lt;-<span class="st"> </span>season_<span class="dv">20</span>_spring <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb129-2" title="2"><span class="st">                        </span><span class="kw">days</span>(<span class="dv">92</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb129-3" title="3"><span class="st">                        </span><span class="kw">hours</span>(<span class="dv">17</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb129-4" title="4"><span class="st">                        </span><span class="kw">minutes</span>(<span class="dv">54</span>)</a>
<a class="sourceLine" id="cb129-5" title="5"></a>
<a class="sourceLine" id="cb129-6" title="6"><span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">&quot;Resulting end of spring: &quot;</span>, season_<span class="dv">20</span>_spring_per,</a>
<a class="sourceLine" id="cb129-7" title="7">            <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Expected end of spring:  &quot;</span>, season_<span class="dv">20</span>_summer))</a></code></pre></div>
<pre><code>## Resulting end of spring:  2020-06-20 22:43:00 
## Expected end of spring:   2020-06-20 23:43:00</code></pre>
<p>This example shows that the use of <code>Durations</code> and <code>Periods</code> must be weighed up and balanced depending on what are you looking for.</p>
<p>In the second approach using the <code>Periods</code> object, there is a one hour difference relative to the first approach. This is because the daylight savings time shift that occured on March 29, 2020 has been implicitly taken into account in the second example.
In other words: Objects of class <code>Durations</code> refer to physical time as if you were using a stop watch, while objects of class <code>Periods</code> refer to the time and date displayed on a usual watch. That is, the length of an object of class <code>Period</code> is not fixed until it is added to a date-time.</p>
</div>
</div>
<div id="math-with-periods" class="section level4">
<h4><span class="header-section-number">5.5.1.2</span> Math with periods</h4>
<p>Using starting points of seasons summer, autumn and winter to create intervals for our data frame.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1">int_season_summer &lt;-<span class="st"> </span><span class="kw">interval</span>(season_<span class="dv">19</span>_summer, season_<span class="dv">19</span>_autumn <span class="op">-</span><span class="st"> </span><span class="kw">minutes</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb131-2" title="2">int_season_autumn &lt;-<span class="st"> </span><span class="kw">interval</span>(season_<span class="dv">19</span>_autumn, season_<span class="dv">19</span>_winter <span class="op">-</span><span class="st"> </span><span class="kw">minutes</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb131-3" title="3">int_season_winter &lt;-<span class="st"> </span>season_<span class="dv">19</span>_winter <span class="op">%--%</span><span class="st"> </span>(season_<span class="dv">20</span>_spring <span class="op">-</span><span class="st"> </span><span class="kw">minutes</span>(<span class="dv">1</span>))</a></code></pre></div>
<p>Note that the <code>%--%</code> operator in the last line is similar to the calls of the <code>interval()</code> function in the lines above.</p>
</div>
</div>
<div id="groupings" class="section level3">
<h3><span class="header-section-number">5.5.2</span> Groupings</h3>
<p>What follows is an intermediate step working with <code>group_by()</code>s and <code>rename()</code>s. Subseqeuntly the findings towards seasons will be applied again.</p>
<p>The following <code>group_by()</code> command creates a unique grouping per hour and then calculates the average temperature for every hour, then pastes this value into each observation per hour.
Recall that <code>tag_int</code> ranges from <code>2020-03-01</code> to <code>2020-03-02</code>.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1">df_sel &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb132-2" title="2"><span class="st">  </span><span class="kw">filter</span>(MESS_DATUM <span class="op">&gt;=</span><span class="st"> </span><span class="kw">int_start</span>(tag_int) <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb132-3" title="3"><span class="st">           </span>MESS_DATUM <span class="op">&lt;=</span><span class="st"> </span><span class="kw">int_end</span>(tag_int))</a>
<a class="sourceLine" id="cb132-4" title="4"></a>
<a class="sourceLine" id="cb132-5" title="5">df_group &lt;-<span class="st"> </span>df_sel <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb132-6" title="6"><span class="st">  </span><span class="kw">group_by</span>(STATIONS_ID, <span class="kw">hour</span>(MESS_DATUM), <span class="kw">day</span>(MESS_DATUM))</a>
<a class="sourceLine" id="cb132-7" title="7"></a>
<a class="sourceLine" id="cb132-8" title="8"><span class="kw">head</span>(df_group, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 9
## # Groups:   STATIONS_ID, hour(MESS_DATUM), day(MESS_DATUM) [2]
##    STATIONS_ID MESS_DATUM          TEMPERATUR RELATIVE_FEUCHTE NIEDERSCHLAGSDA~
##          &lt;int&gt; &lt;dttm&gt;                   &lt;dbl&gt;            &lt;dbl&gt;            &lt;int&gt;
##  1        2564 2020-03-01 00:00:00        5.2             71.1                0
##  2        2564 2020-03-01 00:10:00        5.4             69.5                0
##  3        2564 2020-03-01 00:20:00        5.5             68.2                0
##  4        2564 2020-03-01 00:30:00        5.6             68.3                0
##  5        2564 2020-03-01 00:40:00        5.5             69                  0
##  6        2564 2020-03-01 00:50:00        5.5             69.1                0
##  7        2564 2020-03-01 01:00:00        5.4             69.7                0
##  8        2564 2020-03-01 01:10:00        5.3             70                  0
##  9        2564 2020-03-01 01:20:00        5.3             69.9                0
## 10        2564 2020-03-01 01:30:00        5.2             71                  0
## # ... with 4 more variables: NIEDERSCHLAGSHOEHE &lt;dbl&gt;,
## #   NIEDERSCHLAGSINDIKATOR &lt;dbl&gt;, `hour(MESS_DATUM)` &lt;int&gt;,
## #   `day(MESS_DATUM)` &lt;int&gt;</code></pre>
<p>For better readability, the columns can be renamed after grouping unsing the <code>rename()</code> function.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1">df_group &lt;-<span class="st"> </span>df_sel <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(STATIONS_ID , <span class="kw">hour</span>(MESS_DATUM) , <span class="kw">day</span>(MESS_DATUM)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-3" title="3"><span class="st">  </span><span class="kw">rename</span>(<span class="st">&quot;STUNDE&quot;</span> =<span class="st"> &#39;hour(MESS_DATUM)&#39;</span>, <span class="st">&quot;TAG&quot;</span> =<span class="st"> &#39;day(MESS_DATUM)&#39;</span>)</a>
<a class="sourceLine" id="cb134-4" title="4"></a>
<a class="sourceLine" id="cb134-5" title="5"><span class="kw">head</span>(df_group, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 9
## # Groups:   STATIONS_ID, STUNDE, TAG [2]
##    STATIONS_ID MESS_DATUM          TEMPERATUR RELATIVE_FEUCHTE NIEDERSCHLAGSDA~
##          &lt;int&gt; &lt;dttm&gt;                   &lt;dbl&gt;            &lt;dbl&gt;            &lt;int&gt;
##  1        2564 2020-03-01 00:00:00        5.2             71.1                0
##  2        2564 2020-03-01 00:10:00        5.4             69.5                0
##  3        2564 2020-03-01 00:20:00        5.5             68.2                0
##  4        2564 2020-03-01 00:30:00        5.6             68.3                0
##  5        2564 2020-03-01 00:40:00        5.5             69                  0
##  6        2564 2020-03-01 00:50:00        5.5             69.1                0
##  7        2564 2020-03-01 01:00:00        5.4             69.7                0
##  8        2564 2020-03-01 01:10:00        5.3             70                  0
##  9        2564 2020-03-01 01:20:00        5.3             69.9                0
## 10        2564 2020-03-01 01:30:00        5.2             71                  0
## # ... with 4 more variables: NIEDERSCHLAGSHOEHE &lt;dbl&gt;,
## #   NIEDERSCHLAGSINDIKATOR &lt;dbl&gt;, STUNDE &lt;int&gt;, TAG &lt;int&gt;</code></pre>
<p>Or the columns can be named directly in the <code>group_by()</code> command:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1">df_group &lt;-<span class="st"> </span>df_sel <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(STATIONS_ID , <span class="dt">STUNDE =</span> <span class="kw">hour</span>(MESS_DATUM), <span class="dt">TAG =</span> <span class="kw">day</span>(MESS_DATUM))</a>
<a class="sourceLine" id="cb136-3" title="3"></a>
<a class="sourceLine" id="cb136-4" title="4"><span class="kw">head</span>(df_group, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 9
## # Groups:   STATIONS_ID, STUNDE, TAG [1]
##   STATIONS_ID MESS_DATUM          TEMPERATUR RELATIVE_FEUCHTE NIEDERSCHLAGSDA~
##         &lt;int&gt; &lt;dttm&gt;                   &lt;dbl&gt;            &lt;dbl&gt;            &lt;int&gt;
## 1        2564 2020-03-01 00:00:00        5.2             71.1                0
## 2        2564 2020-03-01 00:10:00        5.4             69.5                0
## 3        2564 2020-03-01 00:20:00        5.5             68.2                0
## 4        2564 2020-03-01 00:30:00        5.6             68.3                0
## 5        2564 2020-03-01 00:40:00        5.5             69                  0
## # ... with 4 more variables: NIEDERSCHLAGSHOEHE &lt;dbl&gt;,
## #   NIEDERSCHLAGSINDIKATOR &lt;dbl&gt;, STUNDE &lt;int&gt;, TAG &lt;int&gt;</code></pre>
<p>Now we can filter the data by year, month, week, day and hour of the day. This should give us possibilities to aggregate freely over any time specifications.</p>
<div id="seasons" class="section level4">
<h4><span class="header-section-number">5.5.2.1</span> Seasons</h4>
<p>At this point we create data frames for analysing seasons.</p>
<div id="spring" class="section level5">
<h5><span class="header-section-number">5.5.2.1.1</span> Spring</h5>
<p>We do not consider the spring season as our data frame does not cover this completely.</p>
</div>
<div id="summer" class="section level5">
<h5><span class="header-section-number">5.5.2.1.2</span> Summer</h5>
<p>The challenge when selecting summer dates is the time zone.
The default time zone in lubridate is UTC, as shown in the example below.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1">df_summer_attempt_<span class="dv">1</span> &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(MESS_DATUM <span class="op">&gt;=</span><span class="st"> </span><span class="kw">int_start</span>(int_season_summer) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb138-2" title="2"><span class="st">                                     </span>MESS_DATUM <span class="op">&lt;=</span><span class="st"> </span><span class="kw">int_end</span>(int_season_summer))</a>
<a class="sourceLine" id="cb138-3" title="3"></a>
<a class="sourceLine" id="cb138-4" title="4"><span class="kw">range</span>(df_summer_attempt_<span class="dv">1</span><span class="op">$</span>MESS_DATUM)</a></code></pre></div>
<pre><code>## [1] &quot;2019-06-21 16:00:00 UTC&quot; &quot;2019-09-23 07:40:00 UTC&quot;</code></pre>
<p>If the expected number of data records does not match the currently determined number, the further analysis should not be continued or repeated.
With the help of assertions (<code>assert()</code>) one can identify logical errors in programs or analyses and end them in a controlled manner, if necessary.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1">rows_sum &lt;-<span class="st"> </span><span class="kw">count</span>(df_summer_attempt_<span class="dv">1</span>)        <span class="co"># or count(df_select_summer, n())</span></a>
<a class="sourceLine" id="cb140-2" title="2">expected_rows_sum &lt;-<span class="st"> </span><span class="dv">13487</span>                    <span class="co"># determined with e.g. excel or SQL</span></a>
<a class="sourceLine" id="cb140-3" title="3"></a>
<a class="sourceLine" id="cb140-4" title="4"><span class="co"># make sure, that the condition &#39;expected_rows_sum == rows_sum&#39; holds</span></a>
<a class="sourceLine" id="cb140-5" title="5"><span class="kw">assert</span>(<span class="st">&quot;expected rows sum&quot;</span> , expected_rows_sum <span class="op">==</span><span class="st"> </span>rows_sum) </a>
<a class="sourceLine" id="cb140-6" title="6"></a>
<a class="sourceLine" id="cb140-7" title="7">expected_summer_start &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(<span class="st">&quot;201906211800&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;UTC&quot;</span>)</a>
<a class="sourceLine" id="cb140-8" title="8">expected_summer_end &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(<span class="st">&quot;201909230940&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;UTC&quot;</span>)</a>
<a class="sourceLine" id="cb140-9" title="9"><span class="co"># </span><span class="al">TODO</span><span class="co"> TZ Umstellung!!!</span></a>
<a class="sourceLine" id="cb140-10" title="10"><span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">&quot;Obtained initial value:&quot;</span>, <span class="kw">min</span>(df_summer_attempt_<span class="dv">1</span><span class="op">$</span>MESS_DATUM), </a>
<a class="sourceLine" id="cb140-11" title="11">            <span class="st">&quot;</span><span class="ch">\n</span><span class="st">obtained final value:  &quot;</span>, <span class="kw">max</span>(df_summer_attempt_<span class="dv">1</span><span class="op">$</span>MESS_DATUM)))</a></code></pre></div>
<pre><code>## Obtained initial value: 2019-06-21 16:00:00 
## obtained final value:   2019-09-23 07:40:00</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1"><span class="co">#assert(&quot;expected summer-start&quot; , expected_summer_start == min(df_summer_attempt_1$MESS_DATUM))</span></a>
<a class="sourceLine" id="cb142-2" title="2"><span class="co">#assert(&quot;expected summer-end&quot; , expected_summer_end == max(df_summer_attempt_1$MESS_DATUM))</span></a></code></pre></div>
<p>While our first approach gets the correct number of records (13,487), the initial value of the interval appear to not be correct since the expected initial value would be <code>2019-06-21 18:00</code>. This expected initial value however is refers to the CET (or more specifically CEST) time zone’s time, which is basically obtained by adding two hours to UTC time, i.e CEST leads UTC be two hours.</p>
<p>In order to print the start and end time points correctly we use the <code>stamp()</code> function of lubridate.
The <code>stamp()</code> function creates more human-readable time formats and internally also reads the system’s time locale by calling <code>Sys.getlocale("LC_TIME")</code>.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1">sf &lt;-<span class="st"> </span><span class="kw">stamp</span>(<span class="st">&quot;set to 24 Jun 2019 3:34&quot;</span>) <span class="co"># create a template format as a function</span></a></code></pre></div>
<pre><code>## Multiple formats matched: &quot;set to %d %Om %Y %H:%M&quot;(1), &quot;set to %d %b %Y %H:%M&quot;(1)</code></pre>
<pre><code>## Using: &quot;set to %d %b %Y %H:%M&quot;</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" title="1"><span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="kw">sf</span>(<span class="kw">int_start</span>(int_season_summer)), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb146-2" title="2">           <span class="kw">sf</span>(<span class="kw">int_end</span>(int_season_summer))))</a></code></pre></div>
<pre><code>## set to 21 Jun 2019 17:54
## set to 23 Sep 2019 09:49</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1">sf &lt;-<span class="st"> </span><span class="kw">stamp</span>(<span class="st">&quot;set to Monday, 24.06.2019 3:34&quot;</span>)</a></code></pre></div>
<pre><code>## Multiple formats matched: &quot;set to Monday, %d.%Om.%Y %H:%M&quot;(1), &quot;set to Monday, %d.%m.%Y %H:%M&quot;(1)</code></pre>
<pre><code>## Using: &quot;set to Monday, %d.%Om.%Y %H:%M&quot;</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" title="1"><span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="kw">sf</span>(<span class="kw">int_start</span>(int_season_summer)), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,</a>
<a class="sourceLine" id="cb151-2" title="2">           <span class="kw">sf</span>(<span class="kw">int_end</span>(int_season_summer))))</a></code></pre></div>
<pre><code>## set to Monday, 21.06.2019 17:54
## set to Monday, 23.09.2019 09:49</code></pre>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" title="1">sf &lt;-<span class="st"> </span><span class="kw">stamp</span>(<span class="st">&quot;Created Sunday, Jan 17, 1999 3:34&quot;</span>)</a></code></pre></div>
<pre><code>## Multiple formats matched: &quot;Created Sunday, %Om %d, %Y %H:%M&quot;(1), &quot;Created Sunday, %b %d, %Y %H:%M&quot;(1)</code></pre>
<pre><code>## Using: &quot;Created Sunday, %b %d, %Y %H:%M&quot;</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" title="1"><span class="kw">print</span>(<span class="kw">sf</span>(<span class="kw">ymd</span>(<span class="st">&quot;2010-04-05&quot;</span>)))</a></code></pre></div>
<pre><code>## [1] &quot;Created Sunday, Apr 05, 2010 00:00&quot;</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" title="1"><span class="co"># print(sf(int_start(int_season_summer)))</span></a>
<a class="sourceLine" id="cb158-2" title="2"><span class="co"># print(sf(int_end(int_season_summer)))</span></a>
<a class="sourceLine" id="cb158-3" title="3"></a>
<a class="sourceLine" id="cb158-4" title="4">sf &lt;-<span class="st"> </span><span class="kw">stamp</span>(<span class="st">&quot;Created 01.01.1999 03:34&quot;</span>)</a></code></pre></div>
<pre><code>## Multiple formats matched: &quot;Created %Om.%d.%Y %H:%M&quot;(1), &quot;Created %d.%Om.%Y %H:%M&quot;(1), &quot;Created %m.%d.%Y %H:%M&quot;(1), &quot;Created %d.%m.%Y %H:%M&quot;(1)</code></pre>
<pre><code>## Using: &quot;Created %Om.%d.%Y %H:%M&quot;</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" title="1"><span class="kw">print</span>(<span class="kw">sf</span>(<span class="kw">ymd</span>(<span class="st">&quot;2010-04-05&quot;</span>)))</a></code></pre></div>
<pre><code>## [1] &quot;Created 04.05.2010 00:00&quot;</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" title="1"><span class="co"># print(sf(int_start(int_season_summer)))</span></a>
<a class="sourceLine" id="cb163-2" title="2"><span class="co"># print(sf(int_end(int_season_summer)))</span></a></code></pre></div>
<p>The function <code>stamp()</code> could be a useful function of lubridate, but is in our opinion a little bit hard to configure.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" title="1">sft &lt;-<span class="st"> &quot;%d.%m.%Y-%H:%M&quot;</span></a>
<a class="sourceLine" id="cb164-2" title="2"><span class="kw">print</span>(<span class="kw">format</span>(<span class="kw">int_start</span>(int_season_summer), sft))</a></code></pre></div>
<pre><code>## [1] &quot;21.06.2019-17:54&quot;</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" title="1"><span class="kw">print</span>(<span class="kw">format</span>(<span class="kw">int_end</span>(int_season_summer), sft))</a></code></pre></div>
<pre><code>## [1] &quot;23.09.2019-09:49&quot;</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" title="1"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Summer start/End format&quot;</span></a>
<a class="sourceLine" id="cb168-2" title="2">            , <span class="kw">format</span>(<span class="kw">int_start</span>(int_season_summer), sft) </a>
<a class="sourceLine" id="cb168-3" title="3">            , <span class="kw">format</span>(<span class="kw">int_end</span>(int_season_summer), sft)</a>
<a class="sourceLine" id="cb168-4" title="4">          ))</a></code></pre></div>
<pre><code>## [1] &quot;Summer start/End format 21.06.2019-17:54 23.09.2019-09:49&quot;</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" title="1"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Summer start/End&quot;</span></a>
<a class="sourceLine" id="cb170-2" title="2">            , <span class="kw">int_start</span>(int_season_summer) </a>
<a class="sourceLine" id="cb170-3" title="3">            , <span class="kw">int_end</span>(int_season_summer)</a>
<a class="sourceLine" id="cb170-4" title="4">          ))</a></code></pre></div>
<pre><code>## [1] &quot;Summer start/End 2019-06-21 17:54:00 2019-09-23 09:49:00&quot;</code></pre>
<p>If we do not set the time zone correctly, we get the expected number of data records with our current data frame, but with a time delay.
Select data with timezone format of the data frame’s first row.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" title="1"><span class="kw">range</span>(df<span class="op">$</span>MESS_DATUM)    <span class="co"># check the range of the whole data frame</span></a></code></pre></div>
<pre><code>## [1] &quot;2019-04-14 00:00:00 UTC&quot; &quot;2020-04-13 23:50:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" title="1">df_tz &lt;-<span class="st"> </span><span class="kw">tz</span>(df<span class="op">$</span>MESS_DATUM[[<span class="dv">1</span>]])                                    <span class="co"># timezone of the first element</span></a>
<a class="sourceLine" id="cb174-2" title="2"><span class="co"># print(paste(&quot;TimeZone:&quot;, df_tz))</span></a>
<a class="sourceLine" id="cb174-3" title="3">df_summer_attempt_<span class="dv">2</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb174-4" title="4"><span class="st">  </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb174-5" title="5"><span class="st">    </span><span class="kw">filter</span>(MESS_DATUM <span class="op">&gt;=</span><span class="st"> </span><span class="kw">force_tz</span>(<span class="kw">int_start</span>(int_season_summer))          <span class="co"># use the lubridate function force_tz</span></a>
<a class="sourceLine" id="cb174-6" title="6">           <span class="op">&amp;</span><span class="st"> </span>MESS_DATUM <span class="op">&lt;=</span><span class="st"> </span><span class="kw">force_tz</span>(<span class="kw">int_end</span>(int_season_summer))) </a>
<a class="sourceLine" id="cb174-7" title="7"><span class="kw">range</span>(df_summer_attempt_<span class="dv">2</span><span class="op">$</span>MESS_DATUM)</a></code></pre></div>
<pre><code>## [1] &quot;2019-06-21 16:00:00 UTC&quot; &quot;2019-09-23 07:40:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" title="1">df_summer_attempt_<span class="dv">3</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb176-2" title="2"><span class="st">  </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb176-3" title="3"><span class="st">    </span><span class="kw">filter</span>(MESS_DATUM <span class="op">&gt;=</span><span class="st"> </span><span class="kw">with_tz</span>(<span class="kw">int_start</span>(int_season_summer),df_tz)     <span class="co"># use the lubridate function with_tz</span></a>
<a class="sourceLine" id="cb176-4" title="4">           <span class="op">&amp;</span><span class="st"> </span>MESS_DATUM <span class="op">&lt;=</span><span class="st"> </span><span class="kw">with_tz</span>(<span class="kw">int_end</span>(int_season_summer),df_tz)) </a>
<a class="sourceLine" id="cb176-5" title="5"><span class="kw">range</span>(df_summer_attempt_<span class="dv">3</span><span class="op">$</span>MESS_DATUM)</a></code></pre></div>
<pre><code>## [1] &quot;2019-06-21 16:00:00 UTC&quot; &quot;2019-09-23 07:40:00 UTC&quot;</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" title="1">n_start_w &lt;-<span class="st"> </span><span class="kw">with_tz</span>(<span class="kw">int_start</span>(int_season_summer),df_tz)</a>
<a class="sourceLine" id="cb178-2" title="2">n_end_w &lt;-<span class="st"> </span><span class="kw">with_tz</span>(<span class="kw">int_end</span>(int_season_summer),df_tz)</a>
<a class="sourceLine" id="cb178-3" title="3"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;with TZ start/end&quot;</span>, n_start_w, <span class="st">&quot;/&quot;</span>, n_end_w))</a></code></pre></div>
<pre><code>## [1] &quot;with TZ start/end 2019-06-21 15:54:00 / 2019-09-23 07:49:00&quot;</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" title="1">n_start_f &lt;-<span class="st"> </span><span class="kw">force_tz</span>(<span class="kw">int_start</span>(int_season_summer),df_tz)                <span class="co"># the optimal way</span></a>
<a class="sourceLine" id="cb180-2" title="2">n_end_f &lt;-<span class="st"> </span><span class="kw">force_tz</span>(<span class="kw">int_end</span>(int_season_summer),df_tz)        </a>
<a class="sourceLine" id="cb180-3" title="3"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Force TZ start/end&quot;</span>, n_start_f, <span class="st">&quot;/&quot;</span>, n_end_f))</a></code></pre></div>
<pre><code>## [1] &quot;Force TZ start/end 2019-06-21 17:54:00 / 2019-09-23 09:49:00&quot;</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" title="1">df_select_summer &lt;-<span class="st">                                                    </span></a>
<a class="sourceLine" id="cb182-2" title="2"><span class="st">  </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-3" title="3"><span class="st">    </span><span class="kw">filter</span>(MESS_DATUM <span class="op">&gt;=</span><span class="st"> </span>n_start_f</a>
<a class="sourceLine" id="cb182-4" title="4">           <span class="op">&amp;</span><span class="st"> </span>MESS_DATUM <span class="op">&lt;=</span><span class="st"> </span>n_end_f) </a>
<a class="sourceLine" id="cb182-5" title="5"><span class="kw">range</span>(df_select_summer<span class="op">$</span>MESS_DATUM)</a></code></pre></div>
<pre><code>## [1] &quot;2019-06-21 18:00:00 UTC&quot; &quot;2019-09-23 09:40:00 UTC&quot;</code></pre>
<p>We check our data frame again.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" title="1">rows_sum &lt;-<span class="st"> </span><span class="kw">count</span>(df_summer_attempt_<span class="dv">1</span>)           <span class="co"># or count(df_select_summer, n())</span></a>
<a class="sourceLine" id="cb184-2" title="2">expected_rows_sum &lt;-<span class="st"> </span><span class="dv">13487</span>                    <span class="co"># determined with e.g. excel or SQL</span></a>
<a class="sourceLine" id="cb184-3" title="3"></a>
<a class="sourceLine" id="cb184-4" title="4"><span class="co"># make sure, that the condition &#39;expected_rows_sum == rows_sum&#39; holds</span></a>
<a class="sourceLine" id="cb184-5" title="5"><span class="kw">assert</span>(<span class="st">&quot;expected rows sum&quot;</span> , expected_rows_sum <span class="op">==</span><span class="st"> </span>rows_sum)</a>
<a class="sourceLine" id="cb184-6" title="6"></a>
<a class="sourceLine" id="cb184-7" title="7">expected_summer_start &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(<span class="st">&quot;201906211800&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;UTC&quot;</span>)</a>
<a class="sourceLine" id="cb184-8" title="8">expected_summer_end &lt;-<span class="st"> </span><span class="kw">ymd_hm</span>(<span class="st">&quot;201909230940&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;UTC&quot;</span>)</a>
<a class="sourceLine" id="cb184-9" title="9"><span class="co"># </span><span class="al">TODO</span><span class="co"> TZ Umstellung!!!</span></a>
<a class="sourceLine" id="cb184-10" title="10"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;summer min and max&quot;</span>, <span class="kw">min</span>(df_select_summer<span class="op">$</span>MESS_DATUM), <span class="kw">max</span>(df_select_summer<span class="op">$</span>MESS_DATUM)))</a></code></pre></div>
<pre><code>## [1] &quot;summer min and max 2019-06-21 18:00:00 2019-09-23 09:40:00&quot;</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" title="1"><span class="kw">assert</span>(<span class="st">&quot;expected summer-start&quot;</span> , expected_summer_start <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(df_select_summer<span class="op">$</span>MESS_DATUM))</a>
<a class="sourceLine" id="cb186-2" title="2"><span class="kw">assert</span>(<span class="st">&quot;expected summer-end&quot;</span> , expected_summer_end <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(df_select_summer<span class="op">$</span>MESS_DATUM))</a></code></pre></div>
</div>
<div id="autumn" class="section level5">
<h5><span class="header-section-number">5.5.2.1.3</span> Autumn</h5>
<p>New attempt to set the start and end points of an interval with the lubridate functions <code>floor_date()</code> and <code>round_date()</code>.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" title="1"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;autumn start/end&quot;</span>, season_<span class="dv">19</span>_autumn, <span class="st">&quot;/&quot;</span>, season_<span class="dv">19</span>_winter))</a></code></pre></div>
<pre><code>## [1] &quot;autumn start/end 2019-09-23 09:50:00 / 2019-12-22 05:19:00&quot;</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" title="1">show_round_up_start &lt;-<span class="st"> </span><span class="kw">round_date</span>(season_<span class="dv">19</span>_autumn, <span class="dt">unit =</span> <span class="st">&quot;hour&quot;</span>)</a>
<a class="sourceLine" id="cb189-2" title="2"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Round hour&quot;</span>,show_round_up_start))</a></code></pre></div>
<pre><code>## [1] &quot;Round hour 2019-09-23 10:00:00&quot;</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" title="1"><span class="co">#TODO - Warum nicht auf 5:10</span></a>
<a class="sourceLine" id="cb191-2" title="2">show_round_down_end &lt;-<span class="st"> </span><span class="kw">floor_date</span>(season_<span class="dv">19</span>_winter, <span class="dt">unit =</span> <span class="st">&quot;hour&quot;</span>)</a>
<a class="sourceLine" id="cb191-3" title="3"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Round minute&quot;</span>,show_round_down_end))</a></code></pre></div>
<pre><code>## [1] &quot;Round minute 2019-12-22 05:00:00&quot;</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" title="1"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;autumn start/end&quot;</span>, show_round_up_start, <span class="st">&quot;/&quot;</span>, show_round_down_end))</a></code></pre></div>
<pre><code>## [1] &quot;autumn start/end 2019-09-23 10:00:00 / 2019-12-22 05:00:00&quot;</code></pre>
<p>These results are not completly satisfying.
So we use our approach from summer selection of data.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" title="1">a_start_f &lt;-<span class="st"> </span><span class="kw">force_tz</span>(<span class="kw">int_start</span>(int_season_autumn), df_tz)        </a>
<a class="sourceLine" id="cb195-2" title="2">a_end_f &lt;-<span class="st"> </span><span class="kw">force_tz</span>(<span class="kw">int_end</span>(int_season_autumn), df_tz)        </a>
<a class="sourceLine" id="cb195-3" title="3"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Force TZ start/end&quot;</span>, a_start_f, <span class="st">&quot;/&quot;</span>, a_end_f))</a></code></pre></div>
<pre><code>## [1] &quot;Force TZ start/end 2019-09-23 09:50:00 / 2019-12-22 05:18:00&quot;</code></pre>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" title="1">df_select_autumn &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb197-2" title="2"><span class="st">  </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb197-3" title="3"><span class="st">    </span><span class="kw">filter</span>(MESS_DATUM <span class="op">&gt;=</span><span class="st"> </span>a_start_f </a>
<a class="sourceLine" id="cb197-4" title="4">           <span class="op">&amp;</span><span class="st"> </span>MESS_DATUM <span class="op">&lt;=</span><span class="st"> </span>a_end_f) </a>
<a class="sourceLine" id="cb197-5" title="5"><span class="kw">print</span>(<span class="kw">count</span>(df_select_autumn))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1 12933</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" title="1">df_group_autumn &lt;-<span class="st"> </span>df_select_autumn <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(STATIONS_ID , <span class="dt">TAG=</span><span class="kw">day</span>(MESS_DATUM) , <span class="dt">MONAT=</span><span class="kw">month</span>(MESS_DATUM) , <span class="dt">JAHR=</span><span class="kw">year</span>(MESS_DATUM)) </a>
<a class="sourceLine" id="cb199-2" title="2"><span class="kw">head</span>(df_group_autumn, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 10
## # Groups:   STATIONS_ID, TAG, MONAT, JAHR [1]
##    STATIONS_ID MESS_DATUM          TEMPERATUR RELATIVE_FEUCHTE NIEDERSCHLAGSDA~
##          &lt;int&gt; &lt;dttm&gt;                   &lt;dbl&gt;            &lt;dbl&gt;            &lt;int&gt;
##  1        2564 2019-09-23 09:50:00       18.8             66.7                0
##  2        2564 2019-09-23 10:00:00       18.9             64.5                0
##  3        2564 2019-09-23 10:10:00       19.5             61.3                0
##  4        2564 2019-09-23 10:20:00       18.9             59.7                0
##  5        2564 2019-09-23 10:30:00       19.4             58.2                0
##  6        2564 2019-09-23 10:40:00       19.6             55.9                0
##  7        2564 2019-09-23 10:50:00       19.8             55.8                0
##  8        2564 2019-09-23 11:00:00       20.2             56.1                0
##  9        2564 2019-09-23 11:10:00       20               57                  0
## 10        2564 2019-09-23 11:20:00       19.3             68.9                0
## # ... with 5 more variables: NIEDERSCHLAGSHOEHE &lt;dbl&gt;,
## #   NIEDERSCHLAGSINDIKATOR &lt;dbl&gt;, TAG &lt;int&gt;, MONAT &lt;dbl&gt;, JAHR &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" title="1"><span class="kw">range</span>(df_select_autumn<span class="op">$</span>MESS_DATUM)</a></code></pre></div>
<pre><code>## [1] &quot;2019-09-23 09:50:00 UTC&quot; &quot;2019-12-22 05:10:00 UTC&quot;</code></pre>
</div>
<div id="winter" class="section level5">
<h5><span class="header-section-number">5.5.2.1.4</span> Winter</h5>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" title="1">w_start_f &lt;-<span class="st"> </span><span class="kw">force_tz</span>(<span class="kw">int_start</span>(int_season_winter),df_tz)        </a>
<a class="sourceLine" id="cb203-2" title="2">w_end_f &lt;-<span class="st"> </span><span class="kw">force_tz</span>(<span class="kw">int_end</span>(int_season_winter),df_tz)        </a>
<a class="sourceLine" id="cb203-3" title="3"><span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&quot;Force TZ start/end&quot;</span>, w_start_f, <span class="st">&quot;/&quot;</span>, w_end_f))</a></code></pre></div>
<pre><code>## [1] &quot;Force TZ start/end 2019-12-22 05:19:00 / 2020-03-20 04:48:00&quot;</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" title="1">df_select_winter &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb205-2" title="2"><span class="st">  </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb205-3" title="3"><span class="st">    </span><span class="kw">filter</span>(MESS_DATUM <span class="op">&gt;=</span><span class="st"> </span>w_start_f <span class="op">&amp;</span><span class="st"> </span>MESS_DATUM <span class="op">&lt;=</span><span class="st"> </span>w_end_f) </a>
<a class="sourceLine" id="cb205-4" title="4"></a>
<a class="sourceLine" id="cb205-5" title="5"><span class="co">#df_group &lt;- df_sel %&gt;% group_by(STATIONS_ID , hour(MESS_DATUM) , day(MESS_DATUM) ) head(df_group, 10)</span></a>
<a class="sourceLine" id="cb205-6" title="6"><span class="kw">range</span>(df_select_winter<span class="op">$</span>MESS_DATUM)</a></code></pre></div>
<pre><code>## [1] &quot;2019-12-22 05:20:00 UTC&quot; &quot;2020-03-20 04:40:00 UTC&quot;</code></pre>
</div>
</div>
</div>
</div>
<div id="exploration---analysis" class="section level2">
<h2><span class="header-section-number">5.6</span> Exploration - Analysis</h2>
<p>First we are going to calculate average temperatures for different standard intervals like hours, days, weeks, months. We will visualise some data and eventually calculate new variables or aggregates for humdity, precipitation etc.y as well, plus more insights, that might not be apparent at this stage.</p>
<div id="temperatur" class="section level3">
<h3><span class="header-section-number">5.6.1</span> Temperatur</h3>
<p>The first variable of interest should be <code>TEMPERATUR</code>. A quick visualisation delivers this picture:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" title="1"><span class="kw">ggplot</span>(df) <span class="op">+</span></a>
<a class="sourceLine" id="cb207-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(MESS_DATUM, TEMPERATUR), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<p><img src="lubridate_files/figure-html/ggplot%20MESS_DATUM%20TEMPERATUR%20for%20JAHR-1.png" width="672" /></p>
<p>This is a representation of all 52,704 observations of temperature and naturally appears quite crowded.
However, a typical course of the seasons during a year can already be interpreted from this plot.
Please note that the chart starts at the start of the observations (April 2019) and stretches over a year from there.</p>
<p>Let’s try to get a clearer picture of the temperature variable during the course of the observed year.
We need to form averages and aggregates to make visualisation more to the point and get less crowded pictures.</p>
<p>New variables should represent other dimensions of date-time data. We can use lubridate functions to produce variables for hours, 24h-days, weeks, months and even possibly seasons.</p>
<p>Assigning a year to every observation by creating a new column with lubridate function <code>year()</code>:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb208-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">JAHR =</span> <span class="kw">year</span>(df<span class="op">$</span>MESS_DATUM))</a></code></pre></div>
<p>Assigning the specific month (number) to every observation by creating a new column with lubridate function <code>month()</code>:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" title="1">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb209-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">MONAT =</span> <span class="kw">month</span>(df<span class="op">$</span>MESS_DATUM))</a></code></pre></div>
<p>Assigning an epiweek number (<code>EKW</code> = Epi Kalender Woche) to every observation through a column with the function <code>epiweek()</code>:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" title="1">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb210-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">EKW =</span> <span class="kw">epiweek</span>(df<span class="op">$</span>MESS_DATUM))</a></code></pre></div>
<p>Assigning a day number to every observation by creating a new column <code>JTAG</code> (Year day):</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" title="1">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb211-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">JTAG =</span> <span class="kw">yday</span>(df<span class="op">$</span>MESS_DATUM))</a></code></pre></div>
<p>Assigning an hour to every observation by creating a new column <code>STUNDE</code>:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" title="1">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb212-2" title="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">STUNDE =</span> <span class="kw">hour</span>(df<span class="op">$</span>MESS_DATUM))</a></code></pre></div>
<p>Our data frame (<code>df</code>) has 12 variables now and thus we can filter the data by year, month, week, day and hour of the day. This gives us new possibilities to aggregate.</p>
<p>The following <code>group_by()</code> command creates a unique grouping per hour and then calculates the average temperature for every hour, then pastes this value into each observation per hour.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" title="1">df_group_Stunde &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb213-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(STATIONS_ID, JAHR, MONAT, EKW, JTAG, STUNDE)</a>
<a class="sourceLine" id="cb213-3" title="3"></a>
<a class="sourceLine" id="cb213-4" title="4">df_av_temp_Stunde  &lt;-<span class="st"> </span>df_group_Stunde <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb213-5" title="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">AVGTEMPH =</span> <span class="kw">mean</span>(TEMPERATUR)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb213-6" title="6"><span class="st">  </span><span class="kw">arrange</span>(STATIONS_ID, JAHR, MONAT, EKW, JTAG, STUNDE)</a></code></pre></div>
<p>This newly created table has reduced the number of observations by the factor 6 to 8,784 and reveals the average temperature per hour.</p>
<p>Let’s plot the data again as hourly temperature averages per day:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" title="1"><span class="kw">ggplot</span>(df_av_temp_Stunde)<span class="op">+</span></a>
<a class="sourceLine" id="cb214-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(JTAG, AVGTEMPH), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<p><img src="lubridate_files/figure-html/ggplot%20avg%20TEMPERATUR%20STUNDE-1.png" width="672" /></p>
<p>We can see that the data has become aggregated and that the temperature picture becomes somewhat more clear.
Also the visualisation now stretches over the course of a whole calendar year from left to right.
Let’s go one step further and shorten the data down to daily averages by:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" title="1">df_group_JTAG &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb215-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(STATIONS_ID, JAHR, MONAT, EKW, JTAG)</a>
<a class="sourceLine" id="cb215-3" title="3"></a>
<a class="sourceLine" id="cb215-4" title="4">df_av_temp_JTAG  &lt;-<span class="st"> </span>df_group_JTAG <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb215-5" title="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">AVGTEMPD =</span> <span class="kw">mean</span>(TEMPERATUR)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb215-6" title="6"><span class="st">  </span><span class="kw">arrange</span>(STATIONS_ID, JAHR, MONAT, EKW, JTAG) </a>
<a class="sourceLine" id="cb215-7" title="7"></a>
<a class="sourceLine" id="cb215-8" title="8"><span class="kw">head</span>(df_av_temp_JTAG, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 6
## # Groups:   STATIONS_ID, JAHR, MONAT, EKW [2]
##    STATIONS_ID  JAHR MONAT   EKW  JTAG AVGTEMPD
##          &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1        2564  2019     4    16   104     4.96
##  2        2564  2019     4    16   105     5.58
##  3        2564  2019     4    16   106     6.43
##  4        2564  2019     4    16   107     8.17
##  5        2564  2019     4    16   108     9.25
##  6        2564  2019     4    16   109     9.63
##  7        2564  2019     4    16   110     8.91
##  8        2564  2019     4    17   111    11.4 
##  9        2564  2019     4    17   112    12.2 
## 10        2564  2019     4    17   113    12.6</code></pre>
<p>This newly created table has reduced the number of observations by the factor 24 to 366 (the number of days in a leap year) and reveals the average temperature per day.
Let’s plot the data again as daily temperature averages over the whole period as a line:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" title="1"><span class="kw">ggplot</span>(df_av_temp_JTAG)<span class="op">+</span></a>
<a class="sourceLine" id="cb217-2" title="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(JTAG, AVGTEMPD), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="lubridate_files/figure-html/ggplot%20avg%20TEMPERATUR%20JTAG-1.png" width="672" /></p>
<p>The data starts to make even more visual sense. The key take-aways from this plot, next to the rather trivial finding of higher summer temperatures, is the rather high volatility that appears to be attached to daily average temperature throughout the year. This could be interpreted as the changes between high and low pressure weather systems that cross northern Germany.</p>
<p>Let’s boil the data down to weekly temperature averages…</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" title="1">df_group_EKW &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(STATIONS_ID, JAHR, MONAT, EKW)</a>
<a class="sourceLine" id="cb218-3" title="3"></a>
<a class="sourceLine" id="cb218-4" title="4">df_av_temp_EKW  &lt;-<span class="st"> </span>df_group_EKW <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-5" title="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">AVGTEMPW =</span> <span class="kw">mean</span>(TEMPERATUR)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-6" title="6"><span class="st">  </span><span class="kw">arrange</span>(STATIONS_ID, JAHR, MONAT, EKW)</a>
<a class="sourceLine" id="cb218-7" title="7"></a>
<a class="sourceLine" id="cb218-8" title="8"><span class="kw">head</span>(df_av_temp_EKW, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
## # Groups:   STATIONS_ID, JAHR, MONAT [3]
##    STATIONS_ID  JAHR MONAT   EKW AVGTEMPW
##          &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1        2564  2019     4    16     7.56
##  2        2564  2019     4    17    13.2 
##  3        2564  2019     4    18    10.4 
##  4        2564  2019     5    18     6.66
##  5        2564  2019     5    19     8.43
##  6        2564  2019     5    20    10.2 
##  7        2564  2019     5    21    13.4 
##  8        2564  2019     5    22    12.9 
##  9        2564  2019     6    22    16.3 
## 10        2564  2019     6    23    17.7</code></pre>
<p>… and plot the results again:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" title="1"><span class="kw">ggplot</span>(df_av_temp_EKW)<span class="op">+</span></a>
<a class="sourceLine" id="cb220-2" title="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(EKW, AVGTEMPW), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="lubridate_files/figure-html/ggplot%20avg%20TEMPERATUR%20WOCHE-1.png" width="672" /></p>
<p>Even in weekly aggregates of temperature averages the resulting visualisation still tells a story of volatility.</p>
<p>Let’s look at monthly averages…</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" title="1">df_group_MONAT &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(STATIONS_ID, JAHR, MONAT)</a>
<a class="sourceLine" id="cb221-3" title="3"></a>
<a class="sourceLine" id="cb221-4" title="4">df_av_temp_MONAT  &lt;-<span class="st"> </span>df_group_MONAT <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-5" title="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">AVGTEMPM =</span> <span class="kw">mean</span>(TEMPERATUR)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb221-6" title="6"><span class="st">  </span><span class="kw">arrange</span>(STATIONS_ID, JAHR, MONAT) </a>
<a class="sourceLine" id="cb221-7" title="7"><span class="kw">head</span>(df_av_temp_MONAT, <span class="dv">12</span>)</a></code></pre></div>
<pre><code>## # A tibble: 12 x 4
## # Groups:   STATIONS_ID, JAHR [2]
##    STATIONS_ID  JAHR MONAT AVGTEMPM
##          &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1        2564  2019     4    10.4 
##  2        2564  2019     5    10.6 
##  3        2564  2019     6    17.9 
##  4        2564  2019     7    17.3 
##  5        2564  2019     8    18.4 
##  6        2564  2019     9    14.0 
##  7        2564  2019    10    10.8 
##  8        2564  2019    11     6.16
##  9        2564  2019    12     5.20
## 10        2564  2020     1     5.74
## 11        2564  2020     2     5.74
## 12        2564  2020     3     5.58</code></pre>
<p>… and plot again:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" title="1"><span class="kw">ggplot</span>(df_av_temp_MONAT)<span class="op">+</span></a>
<a class="sourceLine" id="cb223-2" title="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(MONAT, AVGTEMPM), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="lubridate_files/figure-html/ggplot%20avg%20TEMPERATUR%20MONAT-1.png" width="672" /></p>
<p>Which is the kind of temperature curve we would expect to see in a north German location like Kiel with a clear pattern of 3 months of summer with higher average temperatures just below 20 degrees.</p>
<p>It is interesting to note that at least the first half of April 2020 is apparently much warmer on average than the second half of April in 2019. The dimension indicates a difference of about 2 degrees celsius, a significant difference.</p>
<div id="average-temperature-for-a-day" class="section level4">
<h4><span class="header-section-number">5.6.1.1</span> Average temperature for a day</h4>
<p>Generally, no separate variables would have to be created to determine the average temperatures. The values can be gleaned differently from the data frame.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" title="1">df_avg1 &lt;-<span class="st"> </span>df_group <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb224-2" title="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg =</span> <span class="kw">mean</span>(TEMPERATUR)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb224-3" title="3"><span class="st">  </span><span class="kw">arrange</span>(STATIONS_ID , TAG , STUNDE) </a>
<a class="sourceLine" id="cb224-4" title="4"></a>
<a class="sourceLine" id="cb224-5" title="5"><span class="kw">head</span>(df_avg1, <span class="dv">10</span>) </a></code></pre></div>
<pre><code>## # A tibble: 10 x 4
## # Groups:   STATIONS_ID, STUNDE [10]
##    STATIONS_ID STUNDE   TAG   avg
##          &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1        2564      0     1  5.45
##  2        2564      1     1  5.32
##  3        2564      2     1  5.22
##  4        2564      3     1  5.3 
##  5        2564      4     1  5.53
##  6        2564      5     1  5.58
##  7        2564      6     1  5.35
##  8        2564      7     1  5.9 
##  9        2564      8     1  6.18
## 10        2564      9     1  6.5</code></pre>
<p>What we can say at this point is that the temperatures in the city of Kiel have a clear seasonal pattern, but remain highly volatile intra-day and inter-day.</p>
<p>Weather however is not just defined as temperature, but humidity and precipitation play a role regarding our sensation and definition of weather as well.</p>
</div>
</div>
<div id="precipitation" class="section level3">
<h3><span class="header-section-number">5.6.2</span> Precipitation</h3>
<div id="sum-with-condition" class="section level4">
<h4><span class="header-section-number">5.6.2.1</span> Sum with condition</h4>
<p>The question here is, how long did it rain during an hour/day?
There are two different possible approaches. One is without the binary indicator and the other uses it as a switch.</p>
<p>Without indicator:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" title="1">df_sum1 &lt;-<span class="st"> </span>df_group <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb226-2" title="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">sum</span>(NIEDERSCHLAGSDAUER)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb226-3" title="3"><span class="st">  </span><span class="kw">arrange</span>(STATIONS_ID, TAG, STUNDE)</a>
<a class="sourceLine" id="cb226-4" title="4"></a>
<a class="sourceLine" id="cb226-5" title="5"><span class="kw">head</span>(df_sum1, <span class="dv">24</span>) </a></code></pre></div>
<pre><code>## # A tibble: 24 x 4
## # Groups:   STATIONS_ID, STUNDE [24]
##    STATIONS_ID STUNDE   TAG `sum(NIEDERSCHLAGSDAUER)`
##          &lt;int&gt;  &lt;int&gt; &lt;int&gt;                     &lt;int&gt;
##  1        2564      0     1                         0
##  2        2564      1     1                         0
##  3        2564      2     1                         0
##  4        2564      3     1                         0
##  5        2564      4     1                         0
##  6        2564      5     1                         0
##  7        2564      6     1                         0
##  8        2564      7     1                         0
##  9        2564      8     1                         0
## 10        2564      9     1                         0
## # ... with 14 more rows</code></pre>
<p>With indicator and renamed column:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" title="1">df_sum2 &lt;-<span class="st"> </span>df_group <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb228-2" title="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">MENGE =</span> <span class="kw">sum</span>(NIEDERSCHLAGSDAUER[NIEDERSCHLAGSINDIKATOR <span class="op">==</span><span class="st"> </span><span class="dv">1</span>])) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb228-3" title="3"><span class="st">  </span><span class="kw">filter</span>(MENGE <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb228-4" title="4"><span class="st">  </span><span class="kw">arrange</span>(STATIONS_ID, TAG, STUNDE)</a>
<a class="sourceLine" id="cb228-5" title="5"></a>
<a class="sourceLine" id="cb228-6" title="6"><span class="kw">head</span>(df_sum2, <span class="dv">24</span>) </a></code></pre></div>
<pre><code>## # A tibble: 7 x 4
## # Groups:   STATIONS_ID, STUNDE [7]
##   STATIONS_ID STUNDE   TAG MENGE
##         &lt;int&gt;  &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1        2564     11     1     2
## 2        2564     12     1     3
## 3        2564     13     1    23
## 4        2564     14     1    14
## 5        2564     15     1    10
## 6        2564     18     1    16
## 7        2564     23     1     1</code></pre>
<p>Now we apply the knowledge with the indicator to the selection of autumn.
First we examine the duration of rainfall in autumn.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" title="1">df_sum_autumn_group &lt;-<span class="st"> </span>df_group_autumn </a>
<a class="sourceLine" id="cb230-2" title="2">df_sum_autumn &lt;-<span class="st"> </span>df_sum_autumn_group <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb230-3" title="3"><span class="st">              </span><span class="kw">summarise</span>(<span class="dt">DAUER =</span> <span class="kw">sum</span>(NIEDERSCHLAGSDAUER[NIEDERSCHLAGSINDIKATOR <span class="op">==</span><span class="st"> </span><span class="dv">1</span>])) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb230-4" title="4"><span class="st">              </span><span class="kw">filter</span>(DAUER <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-5" title="5"><span class="st">              </span><span class="kw">arrange</span>(STATIONS_ID, JAHR, MONAT, TAG)</a>
<a class="sourceLine" id="cb230-6" title="6"></a>
<a class="sourceLine" id="cb230-7" title="7"><span class="kw">head</span>(df_sum_autumn, <span class="dv">10</span>) </a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
## # Groups:   STATIONS_ID, TAG, MONAT [10]
##    STATIONS_ID   TAG MONAT  JAHR DAUER
##          &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
##  1        2564    24     9  2019    11
##  2        2564    25     9  2019   593
##  3        2564    26     9  2019   181
##  4        2564    27     9  2019   392
##  5        2564    28     9  2019   228
##  6        2564    29     9  2019  1008
##  7        2564    30     9  2019   354
##  8        2564     1    10  2019   752
##  9        2564     2    10  2019   146
## 10        2564     3    10  2019     2</code></pre>
<p>Now we examine the milliliter of precipitation.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" title="1">df_sum_autumn_liter_group &lt;-<span class="st"> </span>df_group_autumn </a>
<a class="sourceLine" id="cb232-2" title="2">df_sum_autumn_liter &lt;-<span class="st"> </span>df_sum_autumn_liter_group <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-3" title="3"><span class="st">            </span><span class="kw">summarise</span>(<span class="dt">MENGE =</span> <span class="kw">sum</span>(NIEDERSCHLAGSHOEHE[NIEDERSCHLAGSINDIKATOR<span class="op">==</span><span class="dv">1</span>])) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb232-4" title="4"><span class="st">            </span><span class="kw">filter</span>(MENGE <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-5" title="5"><span class="st">            </span><span class="kw">arrange</span>(STATIONS_ID, JAHR, MONAT, TAG)</a>
<a class="sourceLine" id="cb232-6" title="6"></a>
<a class="sourceLine" id="cb232-7" title="7"><span class="kw">head</span>(df_sum_autumn_liter, <span class="dv">10</span>) </a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
## # Groups:   STATIONS_ID, TAG, MONAT [10]
##    STATIONS_ID   TAG MONAT  JAHR MENGE
##          &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1        2564    25     9  2019  0.71
##  2        2564    26     9  2019  1.18
##  3        2564    27     9  2019 13.3 
##  4        2564    28     9  2019  7.57
##  5        2564    29     9  2019 14.6 
##  6        2564    30     9  2019 11.8 
##  7        2564     1    10  2019 15.4 
##  8        2564     2    10  2019  0.36
##  9        2564     4    10  2019  0.1 
## 10        2564     5    10  2019  0.94</code></pre>
</div>
</div>
<div id="humidity" class="section level3">
<h3><span class="header-section-number">5.6.3</span> Humidity</h3>
<p>Let’s have one look at humidity the same way we looked at temperatures as hourly averages:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" title="1">df_av_humi_Stunde  &lt;-<span class="st"> </span>df_group_Stunde <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-2" title="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">AVGHUMI =</span> <span class="kw">mean</span>(RELATIVE_FEUCHTE)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-3" title="3"><span class="st">  </span><span class="kw">arrange</span>(STATIONS_ID, JAHR, MONAT, EKW, JTAG, STUNDE)</a></code></pre></div>
<p>Let’s plot the data again as hourly humidity averages per day:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" title="1"><span class="kw">ggplot</span>(df_av_humi_Stunde)<span class="op">+</span></a>
<a class="sourceLine" id="cb235-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(JTAG, AVGHUMI), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<p><img src="lubridate_files/figure-html/ggplot%20avg%20RELATIVE_FEUCHTE-1.png" width="672" /></p>
<p>This plot shows the drier months during the summer as having a lot more hours with lower humidity values than the months that fall into autumn and winter.</p>
</div>
</div>
<div id="wrap-up" class="section level2">
<h2><span class="header-section-number">5.7</span> Wrap up</h2>
<p>It was our objective to show and explain some of the more important features of the lubridate package. We can definitely say that handling this dataset in Base R would have been a lot more labourious. Working with time series in lubridate is not easy, but feasible.
This statement also goes for the other used packages in this exploration (dplyr, ggplot, etc.) without which the whole task would have been quite tedious.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dplyr.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="forcats.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/tillschwoerer/R-data-science-book/blob/master/lubridate.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
